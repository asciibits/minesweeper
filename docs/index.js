import{a as E,b as R,c as _,d as N,e as u,f as M,g as y,j as F,k as O,l as f,m as W,n as K}from"./chunk-D23Y7H3Q.js";var b=class{worker;encodeListeners=new Set;decodeListeners=new Set;boardListeners=new Map;terminated=!1;lastEncoded;constructor(){M("[BoardIdWorker] Starting Board ID worker"),this.worker=new Worker("./board_id_worker_entry.js",{type:"module",name:"BoardIdWorker"}),this.worker.onerror=e=>{y(`[BoardIdWorker.worker.onerror] Got error. Message: %o
Error: %o
filename: % o
lineno: % o
event: % o`,e.message,e.error,e.filename,e.lineno,e)},this.worker.onmessageerror=e=>{y("[BoardIdWorker.worker.onerror] Got error. Data: %oevent: %o",e.data,e)},this.worker.onmessage=e=>{u("[BoardIdWorker.worker.onmessage] Message to worker received: %o",e);let t=e.data;switch(t.messageType){case"DECODE":let{boardState:s}=t;W(s),this.decodeListeners.forEach(i=>i.handleDecodeResponse(s));break;case"ENCODE":let{encodedBoardState:n}=t;K(n),this.encodeListeners.forEach(i=>i.handleEncodeResponse(n));break;default:throw new Error("Unrecognized message response type: "+JSON.stringify(t))}},M("[BoardIdWorker] Board ID worker initialized")}requestEncode(e){E(!this.terminated,"BoardIdWorker has been terminated");let t=e.getView();if(this.lastEncoded?.view===t)for(let n of this.encodeListeners)n.handleEncodeResponse;let s=ne(e);u("[BoardIdWorker.requestEncode] Sending encode request: %o",s),this.worker.postMessage({messageType:"ENCODE",boardState:s})}requestDecode(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.requestDecode] Sending decode request: %o",e),this.worker.postMessage({messageType:"DECODE",encodedBoardState:e})}addEncodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addEncodeListener]"),this.encodeListeners.add(e)}removeEncodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.removeEncodeListener]"),this.encodeListeners.delete(e)}addDecodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addDecodeListener]"),this.decodeListeners.add(e)}removeDecodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.removeDecodeListener]"),this.decodeListeners.delete(e)}addDecodeToBoardListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addDecodeToBoardListener]");let t={handleDecodeResponse:s=>{f(e,s,{DECODING:!0})}};this.removeDecodeToBoardListener(e),this.boardListeners.set(e,t),this.addDecodeListener(t)}removeDecodeToBoardListener(e){let t=this.boardListeners.get(e);t&&(this.removeDecodeListener(t),this.boardListeners.delete(e))}terminate(){this.terminated=!0,this.encodeListeners.clear(),this.decodeListeners.clear(),this.boardListeners.clear(),this.worker.terminate()}};function ne(r){let e=r.getTimeElapsed(),t=r.getView(),{width:s,height:n}=t,i=r.getAllCells().map(l=>({isMine:t.getCellValue(l.position.x,l.position.y)===-2,openState:l.isOpened()?1:l.isFlagged()?2:0}));return{width:s,height:n,elapsedTime:e,cellData:i}}function q(r){let e,t=new URL(r.location.href),s=t.searchParams.get("board_id");if(s){let n=t.searchParams.get("view_state")??void 0,i=t.searchParams.get("elapsed_time")??void 0;e=new L(r,s,n,i)}else e=new L(r);r.minesweeper=e}var L=class{constructor(e,t,s,n){this.win=e;this.board=new N(new _(1,1,[])),this.board.setClockEventInterval(200),this.board.addListener((c,v)=>this.handleBoardEvent(v)),this.boardIdWorker=this.initBoardIdWorker();let i=re(e);this.bodyElement=i.bodyElement,this.widthElement=i.widthElement,this.heightElement=i.heightElement,this.mineCountElement=i.mineCountElement,this.expertPreset=i.expertPreset,this.intermediatePreset=i.intermediatePreset,this.beginnerPreset=i.beginnerPreset,this.systemColor=i.systemColor,this.lightColor=i.lightColor,this.darkColor=i.darkColor,this.noMineElement=i.noMineElement,this.openAreaElement=i.openAreaElement,this.minePossibleElement=i.minePossibleElement,this.allowUndoElement=i.allowUndoElement,this.singleClickChordElement=i.singleClickChordElement,this.allowFlagChordElement=i.allowFlagChordElement,this.mineFieldBoard=i.mineFieldBoard,this.minefieldBoardWrapper=i.minefieldBoardWrapper,this.resetButton=i.resetButton,this.resetHeader=i.resetHeader,this.minesRemainingDisplay=new w(i.minesRemainingElements),this.timerDisplay=new w(i.timerElements),this.debugElement=i.debugElement;let l=c=>this.handleConfigChangeEvent(c);for(let c of[this.widthElement,this.heightElement,this.mineCountElement,this.noMineElement,this.openAreaElement,this.minePossibleElement])c.addEventListener("change",l);let o=c=>this.handlePresetClickEvent(c);this.expertPreset.addEventListener("click",o),this.intermediatePreset.addEventListener("click",o),this.beginnerPreset.addEventListener("click",o);let d=c=>this.handleColorPaletteEvent(c);this.systemColor.addEventListener("change",d),this.lightColor.addEventListener("change",d),this.darkColor.addEventListener("change",d);let a=c=>this.handlePlayStyleChange(c);this.allowUndoElement.addEventListener("change",a),this.singleClickChordElement.addEventListener("change",a),this.allowFlagChordElement.addEventListener("change",a),this.resetButton.addEventListener("click",()=>this.rebuildMineField());let h=c=>this.handleResetMouseEvent(c),m=c=>this.handleResetTouchEvent(c);this.resetHeader.addEventListener("mousedown",h),this.resetHeader.addEventListener("mouseup",h),this.resetHeader.addEventListener("mouseout",h),this.resetHeader.addEventListener("mouseover",h),this.resetHeader.addEventListener("touchend",m);let p=JSON.parse(e.localStorage?.getItem("settings")??"null");this.setSettings(p),i.boardConfigMenu.ensureState(),i.settingsMenu.ensureState(),this.rebuildMineField(t,s,n)}board;boardIdWorker;bodyElement;widthElement;heightElement;mineCountElement;expertPreset;intermediatePreset;beginnerPreset;systemColor;lightColor;darkColor;noMineElement;openAreaElement;minePossibleElement;allowUndoElement;singleClickChordElement;allowFlagChordElement;mineFieldBoard;minefieldBoardWrapper;resetButton;resetHeader;minesRemainingDisplay;timerDisplay;debugElement;resetMouseDownButtons=0;cellMouseDownButtons=0;cellMouseReleasedButtons=0;cellTouchStart;previousActiveCell;handleBoardEvent(e){switch(e.type){case 8:this.updateMinesRemaining(),this.requestBoardEncode(e.attributes);break;case 6:setTimeout(()=>{for(let t of this.board.getAllCells())t.isOpened()||t.flag(!0,{EXPOSING:!0});this.bodyElement.classList.add("complete")},0);break;case 7:this.bodyElement.classList.remove("complete");break;case 4:setTimeout(()=>{let t=new Set;for(let s of this.board.getAllCells()){let n=s.peek()===-2;n&&!s.isFlagged()?s.isOpened()?s.setWrong(!0,{EXPOSING:!0}):t.add(s):s.isFlagged()&&!n&&s.setWrong(!0,{EXPOSING:!0})}this.board.openGroup(t,{EXPOSING:!0}),this.bodyElement.classList.add("explode")},0);break;case 5:this.bodyElement.classList.remove("explode"),this.board.getAllCells().forEach(t=>t.setWrong(!1));break;case 10:this.updateTimer();break;case 1:this.updateMinesRemaining(),this.updateTimer(),this.resetBoard(),this.widthElement.value=String(this.board.getView().width),this.heightElement.value=String(this.board.getView().height),this.mineCountElement.value=String(this.board.getView().mineCount),e.attributes?.DECODING||(this.bodyElement.classList.remove("in_progress"),this.bodyElement.classList.remove("explode"),this.bodyElement.classList.remove("complete"),this.updateBoardId()),this.minefieldBoardWrapper.classList.remove("blank");break;case 3:this.bodyElement.classList.add("in_progress");break;case 9:this.requestBoardEncode(e.attributes);break}}handleCellEvent(e,t){let s=g(e);if(s)switch(t.type){case 0:s.classList.remove("closed"),s.classList.add("open"),s.classList.remove("pressed"),e.peek()<0?(s.textContent="*",s.classList.add("mine")):this.board.isExploded()||(s.textContent=e.peek().toString(),s.classList.add("n"+e.peek()));break;case 1:s.classList.remove("open"),s.classList.add("closed"),s.classList.remove("pressed"),s.classList.remove("mine"),s.classList.remove("wrong"),s.classList.remove("n1"),s.classList.remove("n2"),s.classList.remove("n3"),s.classList.remove("n4"),s.classList.remove("n5"),s.classList.remove("n6"),s.classList.remove("n7"),s.classList.remove("n8"),s.textContent="";break;case 4:for(let n of Array.from(s.classList))n!=="cell"&&s.classList.remove(n),s.classList.add("closed");break;case 2:e.isFlagged()?(s.classList.add("flagged"),e.isOpened()||(s.textContent="`")):(s.classList.remove("flagged"),e.isOpened()||(s.textContent=""));break;case 3:e.isWrong()?s.classList.add("wrong"):s.classList.remove("wrong");break;case 6:e.isPressed()?s.classList.add("pressed"):s.classList.remove("pressed")}}handleCellMouseEvent(e){let t=this.getCellForUiEvent(e);if(t){switch(e.type){case"mousedown":this.cellMouseDownButtons|=e.buttons,this.cellMouseReleasedButtons=0,e.buttons&1||e.buttons&4?t.pressCellOrChord(!0,this.singleClickChordElement.checked||!!(e.buttons&6),!!(e.buttons&1)):e.buttons&2&&this.processFlag(t);return;case"mouseup":let s=this.cellMouseDownButtons&~e.buttons;this.cellMouseDownButtons&=e.buttons,this.cellMouseReleasedButtons|=s,t.pressCellOrChord(!1),this.cellMouseReleasedButtons&1?this.processClick(t,this.singleClickChordElement.checked||!!(this.cellMouseReleasedButtons&6)):this.cellMouseReleasedButtons&4&&this.processClick(t,!0,!1);break;case"mouseenter":this.cellMouseDownButtons&=e.buttons,this.cellMouseReleasedButtons=0,this.cellMouseDownButtons&1&&t.pressCellOrChord();break;case"mouseleave":this.cellMouseReleasedButtons=0,t.pressCellOrChord(!1);break}e.preventDefault()}}handleCellTouchEvent(e){let t=this.getCellForUiEvent(e);if(!t)return;let s=e.touches.length?e.touches:e.changedTouches;if(s.length!==1){this.cellTouchStart=void 0;return}let n=s[0];switch(this.cellTouchStart&&n.identifier!==this.cellTouchStart.identifier&&(this.cellTouchStart=void 0),e.type){case"touchstart":let{identifier:i,screenX:l,screenY:o}=n;this.cellTouchStart={identifier:i,screenX:l,screenY:o};return;case"touchend":if(!this.cellTouchStart)return;let d=g(t),{width:a,height:h}=d?.getBoundingClientRect?.()??{width:0,height:0},m=this.win.visualViewport?.scale??1,p=Math.abs(n.screenX-(this.cellTouchStart?.screenX??0)),c=Math.abs(n.screenY-(this.cellTouchStart?.screenY??0));console.log("Got touch: %o",{touch:n,scale:m,touchStart:this.cellTouchStart}),p<=a*m&&c<=h*m&&(e.cancelable&&e.preventDefault(),this.processClick(t));break;default:return}}handleCellKeyEvent(e){let t=this.getCellForUiEvent(e);if(!t)return;let{x:s,y:n}=t.position,{width:i,height:l}=this.board.getView(),o=!1;switch(e.key){case"ArrowUp":n--,o=!0;break;case"ArrowDown":n++,o=!0;break;case"ArrowLeft":s--,o=!0;break;case"ArrowRight":s++,o=!0;break;case"Enter":case" ":this.processClick(t,this.singleClickChordElement.checked);break;case"f":this.processFlag(t);break;case"Escape":this.resetButton.focus();break;default:return}if(e.preventDefault(),o){let d=this.board.getCell((s+i)%i,(n+l)%l),a=g(d);this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=a,a.tabIndex=0,a.focus()}}handleConfigChangeEvent(e){if(!e.defaultPrevented&&!this.board.isStarted()){switch(this.highlightActivePreset(),this.saveState(),e.target){case this.widthElement:case this.heightElement:case this.mineCountElement:case this.noMineElement:case this.openAreaElement:case this.minePossibleElement:this.rebuildMineField();break}e.preventDefault()}}handlePresetClickEvent(e){if(!e.defaultPrevented){switch(e.target){case this.expertPreset:this.updateMenuDimensions(30,16,99)&&this.widthElement.dispatchEvent(new Event("change"));break;case this.intermediatePreset:this.updateMenuDimensions(16,16,40)&&this.widthElement.dispatchEvent(new Event("change"));break;case this.beginnerPreset:this.updateMenuDimensions(9,9,10)&&this.widthElement.dispatchEvent(new Event("change"));break;default:return}e.preventDefault()}}handleColorPaletteEvent(e){e.defaultPrevented||(this.setColorPalette(e.target.value),this.saveState(),e.preventDefault())}setColorPalette(e){switch(e){case"SYSTEM":this.bodyElement.classList.remove("light"),this.bodyElement.classList.remove("dark"),this.systemColor.checked=!0;break;case"LIGHT":this.bodyElement.classList.add("light"),this.bodyElement.classList.remove("dark"),this.lightColor.checked=!0;break;case"DARK":this.bodyElement.classList.remove("light"),this.bodyElement.classList.add("dark"),this.darkColor.checked=!0;break;default:return}}handlePlayStyleChange(e){e.defaultPrevented||(this.saveState(),e.preventDefault())}handleResetMouseEvent(e){if(!e.defaultPrevented&&e.target===this.resetHeader&&!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)){switch(e.type){case"mousedown":this.resetMouseDownButtons=e.buttons,this.resetMouseDownButtons&1&&this.resetButton.classList.add("pressed");return;case"mouseup":let t=this.resetMouseDownButtons&~e.buttons;this.resetMouseDownButtons&=e.buttons,t&1&&(this.resetButton.classList.add("pressed"),setTimeout(()=>{this.resetButton.classList.remove("pressed"),this.resetButton.click()},0));break;case"mouseover":this.resetMouseDownButtons&=e.buttons,this.resetMouseDownButtons&1&&this.resetButton.classList.add("pressed");break;case"mouseout":this.resetButton.classList.remove("pressed");break}e.preventDefault()}}handleResetTouchEvent(e){if(!(e.defaultPrevented||e.target!==this.resetHeader||e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.touches.length?e.touches:e.changedTouches).length!==1))switch(e.type){case"touchend":e.cancelable&&(this.resetButton.classList.add("pressed"),setTimeout(()=>{this.resetButton.classList.remove("pressed"),this.resetButton.click()},0),e.preventDefault())}}resetBoard(){this.mineFieldBoard.innerHTML="";let{width:e,height:t}=this.board.getView(),s=(o,d)=>this.handleCellEvent(o,d),n=o=>this.handleCellMouseEvent(o),i=o=>this.handleCellTouchEvent(o),l=o=>this.handleCellKeyEvent(o);for(let o=0;o<t;o++)for(let d=0;d<e;d++){let a=document.createElement("button");a.tabIndex=-1,a.classList.add("cell"),a.classList.add("closed"),a.style.setProperty("grid-row",String(o+1)),a.setAttribute("x",String(d)),a.setAttribute("y",String(o));let h=this.board.getCell(d,o);h.setAttribute("element",a),h.addListener(s),a.addEventListener("mousedown",n),a.addEventListener("mouseup",n),a.addEventListener("mouseenter",n),a.addEventListener("mouseleave",n),a.addEventListener("touchstart",i),a.addEventListener("touchend",i),a.addEventListener("keydown",l),this.mineFieldBoard.appendChild(a)}this.previousActiveCell=this.mineFieldBoard.firstElementChild,this.previousActiveCell.tabIndex=0}updateBoardId(e){let t=new URL(location.href),s=t.search;e?.boardId?(t.searchParams.set("board_id",e?.boardId),e?.viewState?t.searchParams.set("view_state",e?.viewState):t.searchParams.delete("view_state"),e?.elapsedTime?t.searchParams.set("elapsed_time",e?.elapsedTime):t.searchParams.delete("elapsed_time")):(t.searchParams.delete("board_id"),t.searchParams.delete("view_state"),t.searchParams.delete("elapsed_time")),s!==t.search&&(this.allowUndoElement.checked||(s?.length??0)<=1?this.win.history.pushState({},"",t):this.win.history.replaceState({},"",t))}updateElapsedTime(){let e=F(this.board.getTimeElapsed()),t=new URL(location.href);e?t.searchParams.set("elapsed_time",e):t.searchParams.delete("elapsed_time"),this.win.history.replaceState({},"",t)}rebuildMineField(e,t,s){if(e){let n;typeof e=="string"?n=O({boardId:e,viewState:t,elapsedTime:s}):n=e,f(this.board,n,{DECODING:!0})}else{let{width:n,height:i,mines:l,initialClick:o}=this.getBoardConfig();this.board.reset(new R(n,i,l,o))}}getBoardConfig(){let{width:e,height:t,mineCount:s,initialClick:n}=this.getSettings();(!e||isNaN(e)||e<1)&&(e=1),(!t||isNaN(t)||t<1)&&(t=1);let i=e*t;return!s||isNaN(s)||s<1?s=0:s>i&&(s=i),s===i?n=2:s>i-9&&n===1&&(n=2),{width:e,height:t,mines:s,initialClick:n}}updateMenuDimensions(e,t,s){let n=!1;return this.widthElement.valueAsNumber!==e&&(n=!0,this.widthElement.valueAsNumber=e),this.heightElement.valueAsNumber!==t&&(n=!0,this.heightElement.valueAsNumber=t),this.mineCountElement.valueAsNumber!==s&&(n=!0,this.mineCountElement.valueAsNumber=s),this.highlightActivePreset(),n}highlightActivePreset(){let{width:e,height:t,mines:s}=this.getBoardConfig(),n;t===16&&e===30&&s===99?n=this.expertPreset:t===16&&e===16&&s===40?n=this.intermediatePreset:t===9&&e===9&&s===10&&(n=this.beginnerPreset),[this.expertPreset,this.intermediatePreset,this.beginnerPreset].forEach(i=>{i.classList.toggle("active",n===i)})}getSettings(){let e=this.darkColor.checked?"DARK":this.lightColor.checked?"LIGHT":"SYSTEM",t=this.widthElement.valueAsNumber,s=this.heightElement.valueAsNumber,n=this.mineCountElement.valueAsNumber,i=this.openAreaElement.checked?1:this.minePossibleElement.checked?2:0,l=this.allowUndoElement.checked,o=this.singleClickChordElement.checked,d=this.allowFlagChordElement.checked;return{colorPalette:e,width:t,height:s,mineCount:n,initialClick:i,allowUndo:l,singleClickChord:o,allowFlagChord:d}}setSettings(e){switch(this.setColorPalette(e?.colorPalette??"SYSTEM"),e?.initialClick){case 1:this.openAreaElement.checked=!0;break;case 2:this.minePossibleElement.checked=!0;break;default:this.noMineElement.checked=!0;break}this.updateMenuDimensions(e?.width??30,e?.height??16,e?.mineCount??99),this.allowUndoElement.checked=e?.allowUndo??!1,this.singleClickChordElement.checked=e?.singleClickChord??!1,this.allowFlagChordElement.checked=e?.allowFlagChord??!1}saveState(){let e=JSON.stringify(this.getSettings());this.win.localStorage&&this.win.localStorage.setItem("settings",e)}getCellForUiEvent(e){if(e.defaultPrevented||this.board.isExploded()||this.board.isComplete()||e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)return;let t=V(e.target),{x:s,y:n}=t??{x:0,y:0};return this.board.getCell(s,n)}handleEncodeResponse(e){this.updateBoardId(e)}requestBoardEncode(e){!e?.DECODING&&!e?.EXPOSING&&this.boardIdWorker.requestEncode(this.board)}updateMinesRemaining(){this.minesRemainingDisplay.setValue(this.board.getMinesRemaining())}updateTimer(){this.timerDisplay.setValue(this.board.getTimeElapsed()/1e3)&&this.updateElapsedTime()}processClick(e,t=!1,s=!0){this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=g(e),this.previousActiveCell.tabIndex=0,e.isOpened()&&t?e.chord():!e.isFlagged()&&s&&e.open()}processFlag(e){this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=g(e),this.previousActiveCell.tabIndex=0,e.isOpened()&&this.allowFlagChordElement.checked?e.chord():e.flag(!e.isFlagged())}initBoardIdWorker(){let e=new b;return this.win.addEventListener("popstate",()=>{let t=new URL(location.href),s=t.searchParams.get("board_id"),n=t.searchParams.get("view_state")??void 0,i=t.searchParams.get("elapsed_time")??void 0;s?e.requestDecode({boardId:s,viewState:n,elapsedTime:i}):this.allowUndoElement.checked?this.board.getAllCells().forEach(l=>{l.close(),l.flag(!1)}):this.rebuildMineField()}),e.addDecodeToBoardListener(this.board),e.addEncodeListener(this),e}logError(e){console.log(e),this.debugElement.innerHTML+=JSON.stringify(e)+`
`}};function k(r){r.classList.remove("active")}function G(r){r.classList.add("active"),document.activeElement===r.querySelector(".menu_pulldown")&&r.querySelector('[tabindex="0"]')?.focus()}function U(r){return r.classList.contains("active")}function V(r){if(r instanceof HTMLElement){let e=r.getAttribute("x"),t=r.getAttribute("y");return e&&t&&/^[0-9]+$/.test(e)&&/^[0-9]+$/.test(t)?{x:parseInt(e),y:parseInt(t)}:V(r.parentElement)}return null}function g(r){return r.getAttribute("element")}var w=class{constructor(e){this.cells=e}setValue(e){function t(n,i,l){return new Array(Math.max(i-n.length,0)).fill(l).join("")+n}if(typeof e=="number"){e=Math.trunc(e);let n="";e<0&&(n="-",e=-e),e>=10**(this.cells.length-n.length)?e=n+t("",this.cells.length-n.length,"9"):e=t(n+e.toString(),this.cells.length,"0")}else e.length<this.cells.length?e=t(e,this.cells.length," "):e=e.substring(0,this.cells.length);let s=!1;for(let n=0;n<this.cells.length;n++)this.cells[n].innerText!==e[n]&&(s=!0,this.cells[n].innerText=e[n]);return s}};function Y(r){return r.classList.contains("active")||r.checked}function ie(r){return r.findIndex(Y)}var C=class{constructor(e,t,s){this.menu=e;this.menuButton=t;this.menuGroups=s;this.menu.addEventListener("keydown",i=>this.handleKeyEvent(i)),this.menu.addEventListener("focusin",i=>this.handleFocusEvent(i)),this.menu.addEventListener("focusout",i=>this.handleFocusEvent(i)),this.menuButton.addEventListener("pointerdown",i=>this.handleToggleEvent(i));let n=this.menu.getRootNode();n.addEventListener("pointerdown",i=>this.handleCloseEvent(i)),n.addEventListener("keydown",i=>this.handleCloseEvent(i)),n.addEventListener("focusin",i=>this.handleCloseEvent(i))}getGroupIndex(e){return this.menuGroups.map((t,s)=>[s,t.indexOf(e)]).find(t=>t[1]>=0)}handleKeyEvent(e){if(e.defaultPrevented||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;let t=e.target,s=this.getGroupIndex(t),n=this.menuGroups[s[0]],i=(l,o)=>{let d=this.menuGroups[((s?.[0]??-1)+o+this.menuGroups.length)%this.menuGroups.length],a=o===0?s[1]:ie(d);d[(a+l+d.length)%d.length].focus(),this.ensureState()};switch(e.code){case"Escape":k(this.menu);break;case"ArrowDown":i(0,1);break;case"ArrowUp":i(0,-1);break;case"ArrowLeft":if(n.length>1)i(-1,0);else return;break;case"ArrowRight":if(n.length>1)i(1,0);else return;break;default:return}e.preventDefault()}handleFocusEvent(e){if(!e.defaultPrevented)switch(e.type){case"focusin":G(this.menu),this.ensureState();break;case"focusout":this.ensureState();break}}ensureState(){if(this.menu.contains(document.activeElement)&&document.activeElement!==this.menuButton){this.menuGroups.flatMap(s=>s).forEach(s=>s.tabIndex=-1),document.activeElement.tabIndex=0;return}let e,t;for(let s of this.menuGroups)for(let n of s)n.tabIndex===0&&(e?(console.warn("found multiple tabbable elements. Using first"),n.tabIndex=-1):(e=s,t=n));if((!e||!t)&&(e=this.menuGroups[0],t=e[0],t.tabIndex=0),document.activeElement===this.menuButton)t.focus();else if(e.length>1){let s=e.find(Y);s?s!==t&&(t.tabIndex=-1,s.tabIndex=0):t.type==="radio"&&(t.checked=!0)}}handleCloseEvent(e){e.defaultPrevented||!this.menu.contains(e.target)&&e.target!==this.menuButton&&U(this.menu)&&k(this.menu)}handleToggleEvent(e){e.defaultPrevented||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(U(this.menu)?k(this.menu):G(this.menu),e.cancelable&&e.preventDefault())}};function re(r){let e=r.document.getElementsByTagName("body")[0],t=r.document.getElementById("board_menu"),s=r.document.getElementById("board_menu_pulldown"),n=r.document.getElementById("settings_menu"),i=r.document.getElementById("settings_menu_pulldown"),l=r.document.getElementById("width"),o=r.document.getElementById("height"),d=r.document.getElementById("mines"),a=window.document.getElementById("expert_preset"),h=window.document.getElementById("intermediate_preset"),m=window.document.getElementById("beginner_preset"),p=window.document.getElementById("system_color"),c=window.document.getElementById("light_color"),v=window.document.getElementById("dark_color"),T=window.document.getElementById("no_mine"),S=window.document.getElementById("open_area"),D=window.document.getElementById("mine_possible"),P=window.document.getElementById("allow_undo"),H=window.document.getElementById("single_click_chord"),A=window.document.getElementById("allow_flag_chord"),x=window.document.getElementById("board_builder_link"),X=r.document.getElementById("minefield"),J=r.document.getElementById("minefield_board"),z=r.document.getElementById("reset"),Z=r.document.getElementById("header"),j=[1,2,3].map(B=>r.document.getElementById("mines_remaining_"+B)),$=[1,2,3].map(B=>r.document.getElementById("timer_"+B)),Q=r.document.getElementById("debug_element"),ee=new C(t,s,[[a,h,m],[l],[o],[d]]),te=new C(n,i,[[p,c,v],[T,S,D],[P],[H],[A],[x]]);return{bodyElement:e,boardConfigMenu:ee,settingsMenu:te,widthElement:l,heightElement:o,mineCountElement:d,expertPreset:a,intermediatePreset:h,beginnerPreset:m,systemColor:p,lightColor:c,darkColor:v,noMineElement:T,openAreaElement:S,minePossibleElement:D,allowUndoElement:P,singleClickChordElement:H,allowFlagChordElement:A,boardBuilderLink:x,mineFieldBoard:X,minefieldBoardWrapper:J,resetButton:z,resetHeader:Z,minesRemainingElements:j,timerElements:$,debugElement:Q}}var I=typeof window>"u"?void 0:window;I&&I.addEventListener("load",()=>{q(I)});
