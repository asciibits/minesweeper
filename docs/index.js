"use strict";(()=>{function ce(n){n.addEventListener("load",()=>{let e=document.getElementById("expert_chip"),t=document.getElementById("beginner_chip"),i=document.getElementById("intermediate_chip"),r=document.getElementById("custom_chip"),s=document.getElementById("width"),o=document.getElementById("height"),a=document.getElementById("mine_count");function l(u,p,E){let R=!1;return s.value!==u&&(R=!0,s.value=u),o.value!==p&&(R=!0,o.value=p),a.value!==E&&(R=!0,a.value=E),m(),h(),R}e.addEventListener("click",()=>{l("30","16","99")&&s.dispatchEvent(new Event("change"))}),i.addEventListener("click",()=>{l("16","16","40")&&s.dispatchEvent(new Event("change"))}),t.addEventListener("click",()=>{l("9","9","10")&&s.dispatchEvent(new Event("change"))});function m(){let u=s.value,p=o.value,E=a.value;p==="16"&&u==="30"&&E==="99"?e.checked=!0:p==="16"&&u==="16"&&E==="40"?i.checked=!0:p==="9"&&u==="9"&&E==="10"?t.checked=!0:r.checked=!0}[s,o,a].forEach(u=>u.addEventListener("change",()=>{m()}));let f=document.getElementsByTagName("body")[0],b=document.getElementById("system_color"),v=document.getElementById("light_color"),x=document.getElementById("dark_color");b.addEventListener("click",()=>{f.classList.remove("dark"),f.classList.remove("light"),h()}),v.addEventListener("click",()=>{f.classList.remove("dark"),f.classList.add("light"),h()}),x.addEventListener("click",()=>{f.classList.remove("light"),f.classList.add("dark"),h()});let I=document.getElementById("no_mine"),S=document.getElementById("open_area"),y=document.getElementById("mine_possible");I.addEventListener("change",()=>{h()}),S.addEventListener("change",()=>{h()}),y.addEventListener("change",()=>{h()});function D(){let u=x.checked?"DARK":v.checked?"LIGHT":"SYSTEM",p=s.value,E=o.value,R=a.value,ke=S.checked?"ZERO":y.checked?"ANY":"NO_MINE";return{colorPalette:u,width:p,height:E,mineCount:R,initialClick:ke}}function c(u){switch(u?.colorPalette){case"DARK":x.checked||(x.checked=!0,x.dispatchEvent(new Event("click")));break;case"LIGHT":v.checked||(v.checked=!0,v.dispatchEvent(new Event("click")));break;default:b.checked||(b.checked=!0,b.dispatchEvent(new Event("click")));break}switch(u?.initialClick){case"ZERO":S.checked=!0;break;case"ANY":y.checked=!0;break;default:I.checked=!0;break}l(u?.width??"30",u?.height??"16",u?.mineCount??"99")}let g=JSON.parse(localStorage?.getItem("settings")??"null");c(g);function h(){let u=JSON.stringify(D());localStorage&&localStorage.setItem("settings",u)}})}function d(n,e){if(!n)throw new Error(e??`Assertion failed: ${n}`);return n}function Ne(n,e){if(d(e<=n&&n>=0&&e>=0),n-e<e&&(e=n-e),e===0)return 1n;let t=BigInt(n);for(let i=t-1n,r=2n;r<=e;i--,r++)t*=i,t/=r;return t}function he(n,e){d(n>=0,"val must be positive"),d(e>0,"n must be positive");let t=0n,i=1n,r=0n,s=0n;for(let o=0;o<e;o++,n>>=1n)n&1n?(t-=i,i*=++r,i/=++s,t+=i):(i*=++r,i/=r-s);return d(n===0n,"val out of range"),t}function ue(n,e,t){let i=Ne(e,t);d(n>=0n&&n<i,"BoardNumber out of range");let r=BigInt(e),s=BigInt(t),o=0n;for(let a=0;a<e;a++){o<<=1n;let l=i*(r-s)/r;n<l?i=l:(o|=1n,n-=i,i*=s--,i/=r,n+=i),r--}return o}var Z=class{nextIntegers=new Uint32Array(16);nextIndex=16;next(){return this.nextIndex>=this.nextIntegers.length&&(crypto.getRandomValues(this.nextIntegers),this.nextIndex=0),this.nextIntegers[this.nextIndex++]}},V=class{constructor(e=new Z){this.bitSource=e}workingBits=0;availableBits=0;getRandomBits(e){if(d(e>=0&&e<=32,"Random bits must be between 0 and 32"),e===32)return this.bitSource.next()>>>0;let t=0;return this.availableBits<e&&(t=this.workingBits<<e-this.availableBits,e-=this.availableBits,this.workingBits=this.bitSource.next()>>>0,this.availableBits=32),t|=this.workingBits>>>this.availableBits-e,this.availableBits-=e,this.workingBits&=(1<<this.availableBits)-1,t}getRandomInteger(e,t=0){d(t<=e,"Min must be <= max"),e-=t;let i=me(e),r;do r=this.getRandomBits(i);while(r>=e);return r+t}getRandomBigBits(e){d(e>=0,"BitLength must be positive");let t=0n;for(;e>32;)t=t<<32n|BigInt(this.getRandomBits(32)),e-=32n;return t=t<<BigInt(e)|BigInt(this.getRandomBits(Number(e))),t}getRandomBigInteger(e,t=0n){d(t<=e,"Min must be >= 0 and <= max"),e-=t;let i=me(e),r;do r=this.getRandomBigBits(i);while(r>=e);return r+t}getRandomDouble(){let e=new ArrayBuffer(8),t=new Uint32Array(e);return t[0]=this.getRandomBits(32),t[1]=this.getRandomBits(20)|1072693248,new Float64Array(e)[0]-1}};function fe(n,e=n.length,t=De){for(let i=0;i<e;i++){let r=t.getRandomInteger(n.length,i);if(i!=r){let s=n[i];n[i]=n[r],n[r]=s}}return n.length=e,n}function me(n){return typeof n=="number"?32-Math.clz32(n-1):BigInt((n-1n).toString(2).length)}var K=class{random;constructor(e){e=(e??Date.now())&4294967295,typeof jasmine<"u"&&console.log("INSIDE JASMINE!"),typeof process=="object"&&console.log("Using Test seed: %d",e),this.random=Ae(e)}next(){return Math.trunc(this.random()*4294967295)}};function Ae(n){n^=3735928559;let e=Oe(2654435769,608135816,3084996962,n);for(let t=0;t<15;t++)e();return e}function Oe(n,e,t,i){return()=>{n|=0,e|=0,t|=0,i|=0;let r=(n+e|0)+i|0;return i=i+1|0,n=e^e>>>9,e=t+(t<<3)|0,t=t<<21|t>>>11,t=t+r|0,(r>>>0)/4294967296}}function Te(){if(typeof jasmine>"u")return;let n=jasmine?.getEnv()?.configuration()?.seed;if(n)return typeof n=="string"&&(n=Number(n)),isNaN(n)?void 0:n}var De=new V,$e=new V(new K(Te()));function ge(n){return n=(n>>>0)-(n>>>1&1431655765),n=(n&858993459)+(n>>>2&858993459),(n+(n>>>4)&252645135)*16843009>>>24}function Ve(n){return!!n.next}function We(n){return!!n[Symbol.iterator]}function pe(n){return Ve(n)?n:Object.assign(n[Symbol.iterator](),{length:n.length})}function U(n){return We(n)?n:{[Symbol.iterator]:()=>n,length:n.length}}function be(n,e,t){return typeof n=="number"?n:(d(n.x>=0&&n.x<e&&n.y>=0&&n.y<t,"position outside grid"),n.y*e+n.x)}var P=(i=>(i[i.NO_MINE=0]="NO_MINE",i[i.ZERO=1]="ZERO",i[i.ANY=2]="ANY",i))(P||{});function Be(n,e){let t=n.getValueMap(),i=e.getValueMap();return t.length===i.length&&t.every((r,s)=>r===i[s])}var W=class{constructor(e,t,i,r=1,s){this.width=e;this.height=t;this.mineCount=i;this.openingRestriction=r;this.rand=s;d(e>0&&t>0,"Width and height must be positive"),d(i>=0,"Mine count must be positive");let o;switch(r){case 2:o=0;break;case 0:o=1;break;case 1:o=9;break}let a=Math.max(e*t-o,0);d(i<=a,"Not enough space for the mines")}delegate=void 0;getCellValue(e,t){return this.delegate||(this.delegate=C.createRandomMineFieldWithOpening(this.width,this.height,this.mineCount,{x:e,y:t},this.openingRestriction,this.rand)),this.delegate.getCellValue(e,t)}getValueMap(){return this.delegate?.getValueMap()??[]}},C=class n{constructor(e,t,i){this.width=e;this.height=t;d(e>0&&t>0,"Width and height must be positive values"),d(i.length<=e*t,"Mine count must be <= cell count"),this.mineCount=i.length,this.initBoard(i)}mineCount;board=[];_boardNumber;static createRandomMineField(e,t,i,r,s){let o=e*t,a=new Set;for(let m of r?.map(f=>be(f,e,t))??[])d(!a.has(m),"reserved cell already added"),a.add(m);d(i<=o-a.size,"Not enough room for the requested number of mines");let l=fe(Array.from({length:o},(m,f)=>f).filter(m=>!a.has(m)),i,s);return new n(e,t,l)}static createRandomMineFieldWithOpening(e,t,i,r,s=2,o){let{x:a,y:l}=r??{x:0,y:0},m=[];switch(s){case 0:m.push({x:a,y:l});break;case 1:for(let f=Math.max(a-1,0);f<Math.min(a+2,e);f++)for(let b=Math.max(l-1,0);b<Math.min(l+2,t);b++)m.push({x:f,y:b});break;case 2:}return this.createRandomMineField(e,t,i,m,o)}static createMineFieldWithBoardNumber(e,t,i,r){let s=e*t,o=[],a=ue(r,s,i);for(let l=s-1;l>=0;l--,a>>=1n)a&1n&&o.push(l);return new n(e,t,o)}static createMineFieldWithMineMap(e,t,i){let r=[];for(let s=0;s<i.length;s++)i[s]&&r.push(s);return new n(e,t,r)}initBoard(e){let t=this.width,i=this.height;this.board.length=t*i,this.board.fill(0);let r=s=>{let o=typeof s=="number"?Math.trunc(s/t):s.y,a=typeof s=="number"?s-o*t:s.x;if(d(o>=0&&o<i&&a>=0&&a<t,"Mine position is outside the grid"),this.board[a+o*t]<0)throw new Error(`Same cell marked as mine more than once: {X: ${a}, y: ${o}}`);this.board[a+o*t]=-2;for(let l=Math.max(a-1,0);l<Math.min(a+2,t);l++)for(let m=Math.max(o-1,0);m<Math.min(o+2,i);m++)this.board[l+m*t]!==-2&&this.board[l+m*t]++};for(let s of e)r(s)}getBoardNumber(){if(this._boardNumber===void 0){let e=0n;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e<<=1n,this.board[i+t*this.width]<0&&(e|=1n);this._boardNumber=he(e,this.width*this.height)}return this._boardNumber}getCellValue(e,t){return this.board[e+t*this.width]}getValueMap(){return this.board}clearTransientState(){return this._boardNumber=void 0,this}toString(){let e=this.board;return e?Array.from({length:this.height}).map((t,i)=>Array.from({length:this.width}).map((r,s)=>e[s+i*this.width]).map(r=>r===-2?"X":String(r)).join("")).join(`
`):"Uninitialized"}};var A=class{cells=[];listeners=[];cellListener;openMines=0;minesRemaining=0;cellsRemaining=0;boardStarted=0;boardEnded=0;started=!1;view;clockEventInterval=0;timerId;constructor(e){this.cellListener=this.getCellListener(),this.reset(e),this.view=e}getCellVisibleState(e,t){return this.cells[e+t*this.view.width]?.getVisibleState()??-1}getCellListener(){return(e,t)=>{switch(t.type){case 0:if(e.isMine()){let i=this.openMines===0;this.openMines++,t.attributes?.OPEN_GROUP||this.fireEvent(9,t.attributes),i&&(this.stopClock(),this.fireEvent(4,t.attributes))}else this.cellsRemaining--,this.started||(this.started=!0,this.startClock(),this.fireEvent(3,t.attributes)),t.attributes?.OPEN_GROUP||this.fireEvent(9,t.attributes),this.cellsRemaining||(this.stopClock(),this.fireEvent(6,t.attributes));break;case 2:e.isFlagged()?this.minesRemaining--:this.minesRemaining++,this.fireEvent(8,t.attributes);break;case 1:e.isMine()?(this.openMines--,this.openMines||(this.boardEnded=0,this.startClock(),this.fireEvent(5,t.attributes))):this.cellsRemaining++||(console.log("uncompleting"),this.boardEnded=0,this.startClock(),this.fireEvent(7,t.attributes));break}}}expandZeroGroup(e){let t=new Set,i=new Set;function r(){for(let s of i)return i.delete(s),s;throw new Error("Empty")}for(let s of U(e))i.add(s);for(;i.size;){let s=r(),{x:o,y:a}=s.position;if(t.add(s),this.view.getCellValue(o,a)===0)for(let m of s.getNeighbors())t.has(m)||i.add(m)}return t}getCell(e,t){return typeof e=="number"?t===void 0?(d(e>=0&&e<this.cells.length,"Index out of bounds"),this.cells[e]):(d(e>=0&&e<this.view.width&&t>=0&&t<this.view.height,"position outside grid"),this.cells[e+t*this.view.width]):this.cells[be(e,this.view.width,this.view.height)]}getAllCells(){return this.cells}getVisibleStateMap(){return this.cells.map(e=>e.getVisibleState())}isExploded(){return this.openMines>0}isComplete(){return this.started&&this.cellsRemaining<=0}isStarted(){return this.started}getMinesRemaining(){return this.minesRemaining}getCellsRemaining(){return this.cellsRemaining}getTimeElapsed(){return this.boardStarted===0?0:this.boardEnded===0?Date.now()-this.boardStarted:this.boardEnded-this.boardStarted}setTimeElapsed(e,t){this.boardStarted=(this.boardEnded||Date.now())-e,this.startClock(t)}setClockEventInterval(e,t){this.clockEventInterval=e,e>0?this.startClock(t):this.stopClock(t)}startClock(e){this.timerId===void 0&&this.started&&this.boardEnded===0&&this.clockEventInterval>0&&(this.boardStarted||(this.boardStarted=Date.now()),this.fireEvent(10,e),this.timerId=setInterval(()=>{this.fireEvent(10,e)},this.clockEventInterval))}stopClock(e){this.boardStarted!==0&&this.boardEnded===0&&(this.boardEnded=Date.now(),this.fireEvent(10,e)),this.timerId!==void 0&&(clearInterval(this.timerId),this.timerId=void 0)}reset(e,t){this.view=e;for(let s of this.getAllCells())s.dispose(t);let{width:i,height:r}=e;this.cells.length=i*r;for(let s=0;s<i;s++)for(let o=0;o<r;o++)(this.cells[s+o*i]=new j({x:s,y:o},this)).addListener(this.cellListener);this.initializeStats(),this.fireEvent(1,t)}getView(){return this.view}initializeStats(){this.openMines=0;let{width:e,height:t,mineCount:i}=this.getView();this.minesRemaining=i,this.cellsRemaining=e*t-i,this.boardStarted=0,this.boardEnded=0,this.stopClock(),this.started=!1}dispose(e){for(let t of this.cells)t.dispose(e);this.fireEvent(0,e),this.listeners.length=0,this.cells.length=0}openGroup(e,t){for(let i of U(e))i.isOpened()||i.openNoExpand({...t,OPEN_GROUP:!0});this.fireEvent(9,t)}addListener(e){this.listeners.push(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};var j=class{constructor(e,t){this.position=e;this.board=t}flagged=!1;value;opened=!1;pressed=!1;wrong=!1;listeners=[];attributes=new Map;neighbors=[];getVisibleState(){return this.opened?this.peek():this.flagged?-3:-1}isFlagged(){return this.flagged}isMine(){return this.peek()===-2}isOpened(){return this.opened}isPressed(){return this.pressed}isWrong(){return this.wrong}openNoExpand(e){return this.opened||(this.flag(!1),this.opened=!0,this.fireEvent(0,e)),this.peek()}open(e){this.board.openGroup(this.board.expandZeroGroup([this]),e)}peek(){return this.value===void 0&&(this.value=this.board.getView().getCellValue(this.position.x,this.position.y)),this.value}close(e){this.opened&&(this.fireEvent(1,e),this.opened=!1)}chord(e){if(!this.isOpened()||this.isMine())return;let t=0,i=[];this.getNeighbors().forEach(r=>{r.isFlagged()?t++:r.isOpened()||i.push(r)}),t===this.peek()&&this.board.openGroup(this.board.expandZeroGroup(i),e)}flag(e=!0,t){!this.isOpened()&&e!==this.flagged&&(this.flagged=e,this.fireEvent(2,t))}setWrong(e=!0,t){this.wrong!==e&&(this.wrong=e,this.fireEvent(3,t))}press(e=!0,t){this.isOpened()||this.isFlagged()||this.pressed!==e&&(this.pressed=e,this.fireEvent(6,t))}pressChord(e=!0,t){!this.isOpened()||this.isMine()||this.getNeighbors().forEach(i=>i.press(e,t))}pressCellOrChord(e=!0,t){this.isOpened()?this.pressChord(e,t):this.press(e,t)}getNeighbors(){if(!this.neighbors.length){let{x:e,y:t}=this.position,{width:i,height:r}=this.board.getView();for(let s=Math.max(e-1,0);s<Math.min(e+2,i);s++)for(let o=Math.max(t-1,0);o<Math.min(t+2,r);o++)(s!==e||o!==t)&&this.neighbors.push(this.board.getCell(s,o))}return this.neighbors}addListener(e){this.listeners.push(e)}reset(e){this.flagged=!1,this.opened=!1,this.pressed=!1,this.wrong=!1,this.value=void 0,this.fireEvent(4,e)}dispose(e){this.fireEvent(5,e),this.listeners.length=0,this.attributes.clear()}setAttribute(e,t){this.attributes.set(e,t)}getAttribute(e){return this.attributes.get(e)}clearAttribute(e){this.attributes.delete(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};var Pe=2;function q(n,e,...t){if(n<=Pe){let i;switch(n){case 3:i=console.info;break;case 2:i=console.warn;break;case 1:i=console.error;break;default:i=console.log;break}i(e,...t.map(r=>typeof r=="function"?r():r))}}function B(n,...e){q(5,n,...e)}function X(n,...e){q(3,n,...e)}function Y(n,...e){q(1,n,...e)}function*ee(n){yield*Fe(n)}function*Fe(n){for(;!n.isClosed();)yield n.read()}var Q=class{read(){throw new Error("End of stream")}readBatch(){throw new Error("End of stream")}maxBatch(){return 1}readBigBits(){throw new Error("End of stream")}count(){return 0}pending(){return 0}close(){}isClosed(){return!0}},ut=new Q,M=class n{bits;_length=0;constructor(e,t){this.bits=Array.isArray(e)?e:e?[e]:[],this._length=this.bits.length*32,t!==void 0&&t!==this._length&&(this.length=t)}static fromBigint(e){let t=new n;return t.setBigBits(e,0),t}static fromReader(e,t){if(e instanceof _)return e.close(),e.bitset;t=t??-1;let i=new n,r=i.toWriter();function s(){return t<0?e.pending():t>0?Math.min(t,e.pending()):0}let o=s();for(;o;)r.writeBatch(e.readBatch(o),o),t-=o,o=s();return i}get length(){return this._length}set length(e){d(e>=0,"Length must be positive");let t=e+31>>>5;if(t>this.bits.length)for(let i=this.bits.length;i<t;i++)this.bits.push(0);else this.bits.length=t,e<this._length&&(this.bits[this.bits.length-1]&=4294967295>>>-(e&31));this._length=e}trim(){let e;for(e=this.bits.length;e>0&&!this.bits[e-1];--e);return this.bits.length=e,this._length=this.bits.length?(this.bits.length<<5)-Math.clz32(this.bits[this.bits.length-1]):0,this}getBit(e){if(d(e>=0,"Index out of range"),e>=this._length)return 0;let{bytePos:t,bitPos:i}=k(e);return this.bits[t]>>>i&1}setBit(e,t=1){d(e>=0,"Index out of range"),this._length<=e&&(this.length=e+1);let{bytePos:i,bitPos:r}=k(e),s=1<<r;t?this.bits[i]|=s:this.bits[i]&=~s}appendBit(e=1){this.setBit(this._length,e)}clearBit(e){this.setBit(e,0)}getBits(e,t){if(t=t??e+32,d(e>=0&&t>=e,"start or end out of range"),d(t-e<=32,"Too many bits requested - use getBigBits"),e>=this._length)return 0;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0;let{bytePos:r,bitPos:s}=k(e);return s===0&&i===32?this.bits[r]:s+i<=32?this.bits[r]>>>s&4294967295>>>-i:(this.bits[r]>>>s|this.bits[r+1]<<-s)&4294967295>>>-i}setBits(e,t,i){i=i??t+32,d(t>=0&&i>=t,"start or end out of range"),d(i-t<=32,"setting bits limited to 32 bits"),i===void 0&&(i=t+32),i>=this._length&&(this.length=i);let r=i-t;if(r===0)return;let{bytePos:s,bitPos:o}=k(t);if(o+r<=32){let a=4294967295>>>-r<<o;this.bits[s]=this.bits[s]&~a|e<<o&a}else{this.bits[s]=this.bits[s]&4294967295>>>-o|e<<o;let a=4294967295<<o+r;this.bits[s+1]=this.bits[s+1]&a|e>>-o&~a}}appendBits(e,t){if(typeof e=="bigint"){this.appendBigBits(e,t);return}return t=t??32,d(t>=0&&t<=32,"bitCount must be between 0 and 32"),this.setBits(e,this._length,this._length+t)}getBigBits(e,t){if(t=t??Math.max(e,this._length),d(e>=0&&t>=e,"start or end out of range"),e>=this._length)return 0n;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0n;let{bytePos:r,bitPos:s}=k(e);if(s+i<=32)return BigInt((this.bits[r]>>>s&4294967295>>>-i)>>>0);let o=BigInt(i),a=BigInt(this.bits[r]>>>s),l=32-s,m=r+1;for(;o>32+l;m++)a|=BigInt(this.bits[m]>>>0)<<BigInt(l),l+=32;return a|=BigInt((this.bits[m]&4294967295>>>l-i)>>>0)<<BigInt(l),a}setBigBits(e,t,i){if(d(t>=0&&(i===void 0||i>=t),"start or end out of range"),t===i)return 0;let r=t;i&&(e&=(1n<<BigInt(i-t))-1n,this.length=Math.max(this._length,i));let{bytePos:s,bitPos:o}=k(t);e<<=BigInt(o);let a=e<0;a&&(e=~e);let l=4294967295<<o>>>0;if(t+=32-o,e<=l&&(i||(i=Math.max(t-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),i<=t))return l=l<<-i>>>-i,this.bits[s]=this.bits[s]&~l|Number(a?~e:e)&l,i-r;for(o=0,this.length=Math.max(this._length,t),this.bits[s]=this.bits[s]&~l|Number((a?~e:e)&BigInt(l)),e>>=32n,s++;i?i-t>32:this._length-t>32||e>4294967295;)this.length=Math.max(this._length,t+32),this.bits[s++]=Number((a?~e:e)&0xffffffffn)|0,t+=32,e>>=32n;return i||(i=Math.max(t+32-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),l=4294967295>>>-i,this.bits[s]=this.bits[s]&~l|Number((a?~e:e)&BigInt(l)),i-r}appendBigBits(e,t){return this.setBigBits(e,this._length,t===void 0?t:this._length+t)}countBits(){return this.bits.reduce((e,t)=>e+ge(t),0)}shift(e){if(e<0){e=-e;let t=e>>>5,i=e&31;if(i===0)for(let r=0;r<this.bits.length-t;r++)this.bits[r]=this.bits[r+t];else{let r=0;for(;r<this.bits.length-t-1;r++)this.bits[r]=this.bits[r+t]>>>i|this.bits[r+t+1]<<-i;this.bits[r]=this.bits[r+t]>>>i}this.length-=e}else if(e>0){let t=e>>>5,i=e&31;if(this.length+=e+32,i===0)for(let r=this.bits.length-1;r>=t;r--)this.bits[r]=this.bits[r-t];else{for(let r=this.bits.length-1;r>t;r--)this.bits[r]=this.bits[r-t]<<i|this.bits[r-t-1]>>>-i;this.bits[t]=this.bits[0]<<i}this.length-=32}return this}toBigInt(e=0){return this.getBigBits(e,this._length)}toReader(e,t){return new _(this,e,t)}toWriter(e,t){return new w(this,e,t)}clone(){return new n([...this.bits],this._length)}[Symbol.iterator](){return ee(this.toReader())}toString(e=2){let t=this.toBigInt().toString(e);return"0".repeat(Math.max(Math.trunc(Math.log(2**this.length)/Math.log(e))-t.length,0))+t}};function k(n){return{bytePos:n>>>5,bitPos:n&31}}var F=class{constructor(e=-1){this.bitsAvailable=e}done=!1;read(){return d(!this.done,"End of stream"),this.bitsAvailable--,this.getBits(1)}readBatch(e=32){if(e===0)return 0;d(!this.done,"End of stream"),d(e>=0&&e<=32,"bitCount must be between 0 and 32 inclusive");try{return this.bitsAvailable-=e,this.getBits(e)}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}readBigBits(e){d(!this.done,"End of stream"),e=e??-1;try{let t=0n,i=0,r=this.pending();for(;e<0?r>0:e>i;){d(r>0,"End of stream");let s=e<0?r:Math.min(e-i,r);t|=BigInt(this.getBits(s)>>>0)<<BigInt(i),i+=s,this.bitsAvailable-=s,r=this.pending()}return t}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}maxBatch(){return 32}count(){return this.done?0:this.bitsAvailable<0?-1:this.bitsAvailable}pending(){return this.done?0:1}close(){this.done=!0}isClosed(){return this.done}asBigBitReader(){return{read:()=>this.read(),readBatch:e=>this.readBigBits(e),maxBatch:()=>4294967295,count:()=>this.count(),pending:()=>this.pending(),close:()=>this.close(),isClosed:()=>this.isClosed(),asBitReader:()=>this}}},$=class extends F{constructor(t){super();this.iter=t}getBits(t){let i=0;for(let r=0;r<t;r++){let s=this.iter.next();if(s.done)throw this.done=!0,new Error("Stream ended");i|=s.value<<r}return i}};function Ee(n){return new $(pe(n))}var J=class{constructor(e){this.output=e}i=0;closed=!1;write(e){return d(!this.closed),this.output[this.i++]=e,this}writeBatch(e,t=32){for(let i=0;i<t;i++)this.write(e>>>i&1);return this}writeBigBits(e,t=-1){for(let i=0;t<0?e:i<t;i++)this.write(Number(e&1n)),e>>=1n;return this}isClosed(){return this.closed}close(){this.closed=!0}asBigBitWriter(){let e={write:t=>(this.write(t),e),writeBatch:(t,i)=>(this.writeBigBits(t,i),e),isClosed:()=>this.isClosed(),close:()=>this.close(),asBitWriter:()=>this};return e}};function we(n){return new J(n)}var _=class extends F{constructor(t,i=0,r){super();this.bitset=t;this.end=r;d(i>=0,"start must be non-negative"),d(r===void 0||r>=i,"end must be greater than start"),this.pos=i}pos;isClosed(){return this.done||this.pos>=(this.end??this.bitset.length)}getBits(t){d(this.pos+t<=(this.end??this.bitset.length),"No data available");let i=this.pos;return this.pos+=t,this.bitset.getBits(i,this.pos)}count(){return this.done?0:(this.end??this.bitset.length)-this.pos}pending(){let t=this.count(),i=32-(this.pos&31);return t>=0&&t<=i?t:i}},w=class{constructor(e=new M,t=e.length,i){this.end=i;d(t>=0,"start must be non-negative"),d(i===void 0||i>=t,"end must be greater than start"),this.bitset=e??new M,this.pos=t}bitset;pos;closed=!1;isClosed(){return this.closed||!!this.end&&this.pos>=this.end}write(e){return this.assertBitCount(1),this.bitset.setBit(this.pos,e),this.pos++,this}writeBatch(e,t){return t=t??32,this.assertBitCount(t),this.bitset.setBits(e,this.pos,this.pos+t),this.pos+=t,this}writeBigBits(e,t){return this.end!==void 0&&t===void 0&&(t=this.end-this.pos),this.assertBitCount(t??0),t===void 0?t=this.bitset.setBigBits(e,this.pos):this.bitset.setBigBits(e,this.pos,this.pos+t),this.pos+=t,this}close(){this.closed=!0}assertBitCount(e){d(!this.closed,"Stream is closed"),d(!this.end||this.pos+e<=this.end,"End of stream")}asBigBitWriter(){let e={write:t=>(this.write(t),e),writeBatch:(t,i)=>(this.writeBigBits(t,i),e),isClosed:()=>this.isClosed(),close:()=>this.close(),asBitWriter:()=>this};return e}};var ve={encode:n=>n<0?~n<<1|1:n<<1,decode:n=>n&1?~(n>>>1):n>>>1},L=class n{constructor(e,t=0){this.base=e;this.min=t;d(t<=e)}static encode(e,t,i){return new n(t,i).encode(e)}static decode(e,t,i){return new n(t,i).decode(e)}encode(e){return d(e>=this.min),e>=2*(this.base-this.min)+this.min?e-this.min:ve.encode(e-this.base)}decode(e){return d(e>=0),e<2*(this.base-this.min)?ve.decode(e)+this.base:e+this.min}};var O=class{constructor(e,t){this.n=e;this.z=t;d(e>=0),d(t>=0&&t<=e),d(Math.trunc(e)===e&&Math.trunc(t)===t,"n and z must be integers")}encode(e,t){let i=this.n,r=this.z;for(let s of ee(e)){if(t.encodeBit(r/i,s),!--i)return;s||--r}}decode(e,t){let i=this.n,r=this.z;for(;i;--i){let s=e.decodeBit(r/i);t.write(s),s||--r}}};var T=class{constructor(e,t=.5){this.payloadBits=e;this.p=1-t}p;encode(e,t){if(this.payloadBits){for(let i=0;i<this.payloadBits;++i)t.encodeBit(.5,e.isClosed()?0:e.read());if(e.isClosed()){t.encodeBit(.5,0);return}t.encodeBit(.5,1)}for(;;){let i=e.isClosed()?0:e.read();if(e.isClosed()){t.encodeBit(this.p,0);return}t.encodeBit(this.p,1),t.encodeBit(.5,i)}}encodeValue(e,t){this.encode(new w().writeBatch(e).bitset.trim().toReader(),t)}encodeBigInt(e,t){this.encode(new w().writeBigBits(e).bitset.trim().toReader(),t)}decode(e,t){if(this.payloadBits){for(let r=0;r<this.payloadBits;++r)t.write(e.decodeBit(.5));if(!e.decodeBit(.5))return}for(;;){if(!e.decodeBit(this.p)){t.write(1);return}t.write(e.decodeBit(.5))}}decodeValue(e){let t=new M;return this.decode(e,t.toWriter()),d(t.trim().length<=32,"Value too large for a number. Use decodeBigInt"),t.getBits(0)}decodeBigInt(e){let t=new M;return this.decode(e,t.toWriter()),t.toBigInt()}asBigintCoder(){return{encode:(e,t)=>{this.encode(e,t)},decode:(e,t)=>{this.decode(e,t)},encodeValue:(e,t)=>this.encodeBigInt(e,t),decodeValue:e=>this.decodeBigInt(e)}}};var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",_e=new Array(128);for(let n=0;n<Se.length;n++)_e[Se.charCodeAt(n)]=n;function Me(n){let e=n;d(typeof n=="object"&&!!n&&typeof e.height=="number"&&typeof e.width=="number"&&Array.isArray(e.cellData)&&e.cellData.length===e.height*e.width,"Invalid Board State: "+JSON.stringify(n))}function xe(n){let e=n;d(typeof e=="object"&&!!e&&typeof e.boardId=="string"&&(!e.viewState||typeof e.viewState=="string")&&(!e.elapsedTime||typeof e.elapsedTime=="string"),"Invalid Encoded Board State: "+JSON.stringify(n))}var te=class n{static valueCoder=new T(4);encodeValue(e,t){let{height:i,width:r}=e;i===16&&r===30?(t.encodeBit(.5,1),t.encodeBit(.5,1)):i===16&&r===16?(t.encodeBit(.5,1),t.encodeBit(.5,0)):i===9&&r===9?(t.encodeBit(.5,0),t.encodeBit(.5,1)):(t.encodeBit(.5,0),t.encodeBit(.5,0),n.valueCoder.encodeValue(i-1,t),n.valueCoder.encodeValue(L.encode(r,i,1),t))}decodeValue(e){let t=e.decodeBit(.5),i=e.decodeBit(.5),r,s;return t===1&&i===1?(r=16,s=30):t==1&&i===0?(r=16,s=16):t===0&&i===1?(r=9,s=9):(r=n.valueCoder.decodeValue(e)+1,s=L.decode(n.valueCoder.decodeValue(e),r,1)),{width:s,height:r}}},ie=class{constructor(e,t){this.width=e;this.height=t;this.width===30&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=99):this.width===16&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=40):this.width===9&&this.height===9?(this.standardBoardSize=!0,this.expectedMineCount=10):(this.standardBoardSize=!1,this.expectedMineCount=Math.round(this.width*this.height/5));let i=Math.max(32-Math.clz32(this.width*this.height/20),1);this.customCoder=new T(i)}standardBoardSize;expectedMineCount;customCoder;encodeValue(e,t){if(this.standardBoardSize)if(this.expectedMineCount===e){t.encodeBit(.5,1);return}else t.encodeBit(.5,0);this.customCoder.encodeValue(L.encode(e,this.expectedMineCount),t)}decodeValue(e){return this.standardBoardSize&&e.decodeBit(.5)?this.expectedMineCount:L.decode(this.customCoder.decodeValue(e),this.expectedMineCount)}},G=class{cellCount;mineCountCoder;constructor(e,t){this.cellCount=e*t,this.mineCountCoder=new ie(e,t)}encodeValue(e,t){let i=e.reduce((r,s)=>r+s,0);this.mineCountCoder.encodeValue(i,t),new O(this.cellCount,this.cellCount-i).encode(Ee(e),t)}decodeValue(e){let t=this.mineCountCoder.decodeValue(e),i=new O(this.cellCount,this.cellCount-t),r=[];return i.decode(e,we(r)),r}};var ne=class n{static dimensionCoder=new te;encodeValue(e,t){let{width:i,height:r}=e,s=e.cellData.map(o=>o.isMine?1:0);n.dimensionCoder.encodeValue(e,t),new G(i,r).encodeValue(s,t)}decodeValue(e){let{width:t,height:i}=n.dimensionCoder.decodeValue(e),s=new G(t,i).decodeValue(e).map(o=>({isMine:!!o}));return{width:t,height:i,cellData:s}}},Yt=new ne;var z=class{worker;encodeListeners=new Set;decodeListeners=new Set;boardListeners=new Map;terminated=!1;lastEncoded;constructor(){X("[BoardIdWorker] Starting Board ID worker"),this.worker=new Worker("./board_id_worker_entry.js",{type:"module",name:"BoardIdWorker"}),this.worker.onerror=e=>{Y(`[BoardIdWorker.worker.onerror] Got error. Message: %o
Error: %o
filename: % o
lineno: % o
event: % o`,e.message,e.error,e.filename,e.lineno,e)},this.worker.onmessageerror=e=>{Y("[BoardIdWorker.worker.onerror] Got error. Data: %oevent: %o",e.data,e)},this.worker.onmessage=e=>{B("[BoardIdWorker.worker.onmessage] Message to worker received: %o",e);let t=e.data;switch(t.messageType){case"DECODE":let{boardState:i}=t;Me(i),this.decodeListeners.forEach(s=>s.handleDecodeResponse(i));break;case"ENCODE":let{encodedBoardState:r}=t;xe(r),this.encodeListeners.forEach(s=>s.handleEncodeResponse(r));break;default:throw new Error("Unrecognized message response type: "+JSON.stringify(t))}},X("[BoardIdWorker] Board ID worker initialized")}requestEncode(e){d(!this.terminated,"BoardIdWorker has been terminated");let t=e.getView();if(this.lastEncoded?.view===t)for(let r of this.encodeListeners)r.handleEncodeResponse;let i=He(e);B("[BoardIdWorker.requestEncode] Sending encode request: %o",i),this.worker.postMessage({messageType:"ENCODE",boardState:i})}requestDecode(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.requestDecode] Sending decode request: %o",e),this.worker.postMessage({messageType:"DECODE",encodedBoardState:e})}addEncodeListener(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.addEncodeListener]"),this.encodeListeners.add(e)}removeEncodeListener(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.removeEncodeListener]"),this.encodeListeners.delete(e)}addDecodeListener(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.addDecodeListener]"),this.decodeListeners.add(e)}removeDecodeListener(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.removeDecodeListener]"),this.decodeListeners.delete(e)}addDecodeToBoardListener(e){d(!this.terminated,"BoardIdWorker has been terminated"),B("[BoardIdWorker.addDecodeToBoardListener]");let t={handleDecodeResponse:i=>{let r=ze(i),s=!Be(r,e.getView());s&&e.reset(r,{DECODING:!0});let o=new Set;for(let a=0;a<i.cellData.length;a++){let l=e.getCell(a);switch(l.setWrong(!1,{DECODING:!0}),i.cellData[a].openState){case 1:l.isMine()?o.add(l):l.openNoExpand({DECODING:!0});break;case 2:l.close({DECODING:!0}),l.flag(!0,{DECODING:!0});break;default:l.close({DECODING:!0}),l.flag(!1,{DECODING:!0});break}}e.openGroup(o,{DECODING:!0}),s&&i.elapsedTime&&e.setTimeElapsed(i.elapsedTime,{DECODING:!0}),(e.isComplete()||e.isExploded())&&e.fireEvent(10,{DECODING:!0})}};this.removeDecodeToBoardListener(e),this.boardListeners.set(e,t),this.addDecodeListener(t)}removeDecodeToBoardListener(e){let t=this.boardListeners.get(e);t&&(this.removeDecodeListener(t),this.boardListeners.delete(e))}terminate(){this.terminated=!0,this.encodeListeners.clear(),this.decodeListeners.clear(),this.boardListeners.clear(),this.worker.terminate()}};function ze(n){let{width:e,height:t,cellData:i}=n;return C.createMineFieldWithMineMap(e,t,i.map(r=>r.isMine))}function He(n){let e=n.getTimeElapsed(),t=n.getView(),{width:i,height:r}=t,s=n.getAllCells().map(o=>({isMine:t.getCellValue(o.position.x,o.position.y)===-2,openState:o.isOpened()?1:o.isFlagged()?2:0}));return{width:i,height:r,elapsedTime:e,cellData:s}}var se,oe,ae,de,Ie,N;function Le(n){n.addEventListener("load",()=>{N=new z,se=n.document.getElementById("width"),oe=n.document.getElementById("height"),ae=n.document.getElementById("mine_count");let e=n.document.getElementById("sidebar");de=Array.from(e.querySelectorAll("[name=initial_click]")).filter(c=>c instanceof HTMLInputElement),Ie=n.document.getElementById("minefield");let t=n.document.getElementById("minefield_board"),i=n.document.getElementById("reset"),r=n.document.getElementById("header");function s(c,g=!1){let h=new URL(location.href);c?.boardId?(h.searchParams.set("board_id",c?.boardId),c?.viewState?h.searchParams.set("view_state",c?.viewState):h.searchParams.delete("view_state"),c?.elapsedTime?h.searchParams.set("elapsed_time",c?.elapsedTime):h.searchParams.delete("elapsed_time")):(h.searchParams.delete("board_id"),h.searchParams.delete("view_state"),h.searchParams.delete("elapsed_time")),g?n.history.replaceState({},"",h):n.history.pushState({},"",h)}n.addEventListener("popstate",()=>{let c=new URL(location.href),g=c.searchParams.get("board_id"),h=c.searchParams.get("view_state")??void 0,u=c.searchParams.get("elapsed_time")??void 0;g?N.requestDecode({boardId:g,viewState:h,elapsedTime:u}):a.getAllCells().forEach(p=>{p.close(),p.flag(!1)})});function o(c){!c?.DECODING&&!c?.EXPOSING&&N.requestEncode(a)}N.addEncodeListener({handleEncodeResponse:c=>{s(c)}});let a=new A(new C(1,1,[]));n.board=a,N.addDecodeToBoardListener(a);let l=void 0;a.setClockEventInterval(200);let m=new H([1,2,3].map(c=>n.document.getElementById("mines_remaining_"+c)));function f(){m.setValue(a.getMinesRemaining())}let b=new H([1,2,3].map(c=>n.document.getElementById("timer_"+c)));function v(){b.setValue(a.getTimeElapsed()/1e3)}function x(c,g){switch(g.type){case 8:f(),o(g.attributes);break;case 6:setTimeout(()=>{for(let h of a.getAllCells())h.isOpened()||h.flag(!0,{EXPOSING:!0});i.innerText="\u{1F60E}"},0);break;case 7:i.innerText="\u{1F914}";break;case 4:setTimeout(()=>{let h=new Set;for(let u of a.getAllCells()){let p=u.peek()===-2;p&&!u.isFlagged()?u.isOpened()?u.setWrong(!0,{EXPOSING:!0}):h.add(u):u.isFlagged()&&!p&&u.setWrong(!0,{EXPOSING:!0})}a.openGroup(h,{EXPOSING:!0}),i.innerText="\u{1F635}"},0);break;case 5:i.innerText="\u{1F914}",a.getAllCells().forEach(h=>h.setWrong(!1));break;case 10:v();break;case 1:i.innerText="\u{1F600}",f(),v(),Ze(Ie,a,l),se.value=String(a.getView().width),oe.value=String(a.getView().height),ae.value=String(a.getView().mineCount),de.filter(h=>h.value===P[re().openingConfig]).forEach(h=>h.checked=!0),g.attributes?.DECODING||s(),t.classList.remove("blank");break;case 3:i.innerText="\u{1F914}";break;case 9:o(g.attributes);break}}a.addListener(x);function I(){try{let{width:c,height:g,mines:h,openingConfig:u}=re();a.reset(new W(c,g,h,u))}catch(c){ye(c)}}e.addEventListener("change",c=>{let h=c.target?.attributes.getNamedItem("name")?.value;if(h==="color_palette")return;let{width:u,height:p,mines:E}=re();(a.getView().width!==u||a.getView().height!==p||a.getView().mineCount!==E)&&I(),!a.isStarted()&&h==="initial_click"&&I()});let S=c=>{try{if(c.button!==0)return;switch(c.type){case"mousedown":i.classList.add("pressed");break;case"mouseup":i.classList.remove("pressed"),I();break;case"mouseenter":c.buttons===1&&i.classList.add("pressed");break;case"mouseleave":c.buttons===1&&i.classList.remove("pressed");break}}catch(g){ye(g)}};r.addEventListener("mousedown",S),r.addEventListener("mouseup",S),r.addEventListener("mouseenter",S),r.addEventListener("mouseleave",S);let y=new URL(location.href),D=y.searchParams.get("board_id");if(D){let c=y.searchParams.get("view_state")??void 0,g=y.searchParams.get("elapsed_time")??void 0;N.requestDecode({boardId:D,viewState:c,elapsedTime:g})}else I()})}function Ze(n,e,t){n.innerHTML="";let{width:i,height:r}=e.getView(),s=[],o=Ke(e),a=Ue(e,t);for(let l=0;l<r;l++)for(let m=0;m<i;m++){let f=document.createElement("div");f.classList.add("cell"),f.classList.add("closed"),f.style.setProperty("grid-row",String(l+1)),f.setAttribute("x",String(m)),f.setAttribute("y",String(l));let b=e.getCell(m,l);b.setAttribute("element",f),b.addListener(o),f.addEventListener("mousedown",a),f.addEventListener("mouseup",a),f.addEventListener("mouseenter",a),f.addEventListener("mouseleave",a),n.appendChild(f)}return s.join(`
`)}function Ke(n){return(e,t)=>{let i=e.getAttribute("element");if(i)switch(t.type){case 0:i.classList.remove("closed"),i.classList.add("open"),i.classList.remove("pressed"),e.peek()<0?i.classList.add("mine"):e.peek()>0&&(n.isExploded()||i.classList.add("n"+e.peek()));break;case 1:i.classList.remove("open"),i.classList.add("closed"),i.classList.remove("pressed"),i.classList.remove("mine"),i.classList.remove("wrong"),i.classList.remove("n1"),i.classList.remove("n2"),i.classList.remove("n3"),i.classList.remove("n4"),i.classList.remove("n5"),i.classList.remove("n6"),i.classList.remove("n7"),i.classList.remove("n8");break;case 4:for(let r of Array.from(i.classList))r!=="cell"&&i.classList.remove(r),i.classList.add("closed");break;case 2:e.isFlagged()?i.classList.add("flagged"):i.classList.remove("flagged");break;case 3:e.isWrong()?i.classList.add("wrong"):i.classList.remove("wrong");break;case 6:e.isPressed()?i.classList.add("pressed"):i.classList.remove("pressed")}}}function Ue(n,e){return t=>{let i=Re(t.target);if(!i)return;let r=n.getCell(i.x,i.y);r&&(t.preventDefault(),!(n.isExploded()||n.isComplete())&&(t.button===2&&t.type==="mousedown"&&(r.isOpened()?r.chord():r.flag(!r.isFlagged())),t.button===0&&t.type==="mouseup"&&(!r.isFlagged()&&!r.isOpened()?r.open():r.isOpened()&&r.chord()),(t.button===0&&t.type==="mousedown"||t.buttons===1&&t.type==="mouseenter")&&r.pressCellOrChord(),(t.button===0&&t.type==="mouseup"||t.buttons===1&&t.type==="mouseleave")&&r.pressCellOrChord(!1)))}}function Re(n){if(n instanceof HTMLElement){let e=n.getAttribute("x"),t=n.getAttribute("y");return e&&t&&/^[0-9]+$/.test(e)&&/^[0-9]+$/.test(t)?{x:parseInt(e),y:parseInt(t)}:Re(n.parentElement)}return null}var H=class{constructor(e){this.cells=e}setValue(e){function t(i,r,s){return new Array(Math.max(r-i.length,0)).fill(s).join("")+i}if(typeof e=="number"){e=Math.trunc(e);let i="";e<0&&(i="-",e=-e),e>=10**(this.cells.length-i.length)?e=i+t("",this.cells.length-i.length,"9"):e=t(i+e.toString(),this.cells.length,"0")}else e.length<this.cells.length?e=t(e,this.cells.length," "):e=e.substring(0,this.cells.length);for(let i=0;i<this.cells.length;i++)this.cells[i].innerText=e[i]}};function re(){let n=se.valueAsNumber,e=oe.valueAsNumber,t=ae.valueAsNumber,i=de.find(o=>o.checked)?.value,r=P[i]??2;(isNaN(n)||n<1)&&(n=1),(isNaN(e)||e<1)&&(e=1);let s=n*e;return isNaN(t)||t<1?t=0:t>s&&(t=s),t===s?r=2:t>s-9&&r===1&&(r=2),{width:n,height:e,mines:t,openingConfig:r}}function ye(n){console.log(n)}var le=typeof window>"u"?void 0:window;le&&(ce(le),Le(le));})();
