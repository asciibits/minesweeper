"use strict";(()=>{function l(r,e){if(!r)throw new Error(e??`Assertion failed: ${r}`);return r}function Le(r,e){if(l(e<=r&&r>=0&&e>=0),r-e<e&&(e=r-e),e===0)return 1n;let t=BigInt(r);for(let i=t-1n,n=2n;n<=e;i--,n++)t*=i,t/=n;return t}function de(r,e){l(r>=0,"val must be positive"),l(e>0,"n must be positive");let t=0n,i=1n,n=0n,s=0n;for(let o=0;o<e;o++,r>>=1n)r&1n?(t-=i,i*=++n,i/=++s,t+=i):(i*=++n,i/=n-s);return l(r===0n,"val out of range"),t}function le(r,e,t){let i=Le(e,t);l(r>=0n&&r<i,"BoardNumber out of range");let n=BigInt(e),s=BigInt(t),o=0n;for(let a=0;a<e;a++){o<<=1n;let d=i*(n-s)/n;r<d?i=d:(o|=1n,r-=i,i*=s--,i/=n,r+=i),n--}return o}var H=class{nextIntegers=new Uint32Array(16);nextIndex=16;next(){return this.nextIndex>=this.nextIntegers.length&&(crypto.getRandomValues(this.nextIntegers),this.nextIndex=0),this.nextIntegers[this.nextIndex++]}},O=class{constructor(e=new H){this.bitSource=e}workingBits=0;availableBits=0;getRandomBits(e){if(l(e>=0&&e<=32,"Random bits must be between 0 and 32"),e===32)return this.bitSource.next()>>>0;let t=0;return this.availableBits<e&&(t=this.workingBits<<e-this.availableBits,e-=this.availableBits,this.workingBits=this.bitSource.next()>>>0,this.availableBits=32),t|=this.workingBits>>>this.availableBits-e,this.availableBits-=e,this.workingBits&=(1<<this.availableBits)-1,t}getRandomInteger(e,t=0){l(t<=e,"Min must be <= max"),e-=t;let i=he(e),n;do n=this.getRandomBits(i);while(n>=e);return n+t}getRandomBigBits(e){l(e>=0,"BitLength must be positive");let t=0n;for(;e>32;)t=t<<32n|BigInt(this.getRandomBits(32)),e-=32n;return t=t<<BigInt(e)|BigInt(this.getRandomBits(Number(e))),t}getRandomBigInteger(e,t=0n){l(t<=e,"Min must be >= 0 and <= max"),e-=t;let i=he(e),n;do n=this.getRandomBigBits(i);while(n>=e);return n+t}getRandomDouble(){let e=new ArrayBuffer(8),t=new Uint32Array(e);return t[0]=this.getRandomBits(32),t[1]=this.getRandomBits(20)|1072693248,new Float64Array(e)[0]-1}};function ue(r,e=r.length,t=ke){for(let i=0;i<e;i++){let n=t.getRandomInteger(r.length,i);if(i!=n){let s=r[i];r[i]=r[n],r[n]=s}}return r.length=e,r}function he(r){return typeof r=="number"?32-Math.clz32(r-1):BigInt((r-1n).toString(2).length)}var _=class{random;constructor(e){e=(e??Date.now())&4294967295,console.log("Using Test seed: %d",e),this.random=Ae(e)}next(){return Math.trunc(this.random()*4294967295)}};function Ae(r){r^=3735928559;let e=Ne(2654435769,608135816,3084996962,r);for(let t=0;t<15;t++)e();return e}function Ne(r,e,t,i){return function(){r|=0,e|=0,t|=0,i|=0;let n=(r+e|0)+i|0;return i=i+1|0,r=e^e>>>9,e=t+(t<<3)|0,t=t<<21|t>>>11,t=t+n|0,(n>>>0)/4294967296}}function Oe(){if(typeof jasmine>"u")return;let r=jasmine?.getEnv()?.configuration()?.seed;if(r)return typeof r=="string"&&(r=Number(r)),isNaN(r)?void 0:r}var ke=new O,Ye=new O(new _(Oe()));function ce(r){return r=(r>>>0)-(r>>>1&1431655765),r=(r&858993459)+(r>>>2&858993459),(r+(r>>>4)&252645135)*16843009>>>24}function Te(r){return!!r[Symbol.iterator]}function z(r){return Te(r)?r:{[Symbol.iterator]:()=>r,length:r.length}}function me(r,e,t){return typeof r=="number"?r:(l(r.x>=0&&r.x<e&&r.y>=0&&r.y<t,"position outside grid"),r.y*e+r.x)}var T=(i=>(i[i.NO_MINE=0]="NO_MINE",i[i.ZERO=1]="ZERO",i[i.ANY=2]="ANY",i))(T||{});function fe(r,e){let t=r.getValueMap(),i=e.getValueMap();return t.length===i.length&&t.every((n,s)=>n===i[s])}var k=class{constructor(e,t,i,n=1,s){this.width=e;this.height=t;this.mineCount=i;this.openingRestriction=n;this.rand=s;l(e>0&&t>0,"Width and height must be positive"),l(i>=0,"Mine count must be positive");let o;switch(n){case 2:o=0;break;case 0:o=1;break;case 1:o=9;break}let a=Math.max(e*t-o,0);l(i<=a,"Not enough space for the mines")}delegate=void 0;getCellValue(e,t){return this.delegate||(this.delegate=C.createRandomMineFieldWithOpening(this.width,this.height,this.mineCount,{x:e,y:t},this.openingRestriction,this.rand)),this.delegate.getCellValue(e,t)}getValueMap(){return this.delegate?.getValueMap()??[]}},C=class r{constructor(e,t,i){this.width=e;this.height=t;l(e>0&&t>0,"Width and height must be positive values"),l(i.length<=e*t,"Mine count must be <= cell count"),this.mineCount=i.length,this.initBoard(i)}mineCount;board=[];_boardNumber;static createRandomMineField(e,t,i,n,s){let o=e*t,a=new Set;for(let h of n?.map(u=>me(u,e,t))??[])l(!a.has(h),"reserved cell already added"),a.add(h);l(i<=o-a.size,"Not enough room for the requested number of mines");let d=ue(Array.from({length:o},(h,u)=>u).filter(h=>!a.has(h)),i,s);return new r(e,t,d)}static createRandomMineFieldWithOpening(e,t,i,n,s=2,o){let{x:a,y:d}=n??{x:0,y:0},h=[];switch(s){case 0:h.push({x:a,y:d});break;case 1:for(let u=Math.max(a-1,0);u<Math.min(a+2,e);u++)for(let g=Math.max(d-1,0);g<Math.min(d+2,t);g++)h.push({x:u,y:g});break;case 2:}return this.createRandomMineField(e,t,i,h,o)}static createMineFieldWithBoardNumber(e,t,i,n){let s=e*t,o=[],a=le(n,s,i);for(let d=s-1;d>=0;d--,a>>=1n)a&1n&&o.push(d);return new r(e,t,o)}static createMineFieldWithMineMap(e,t,i){let n=[];for(let s=0;s<i.length;s++)i[s]&&n.push(s);return new r(e,t,n)}initBoard(e){let t=this.width,i=this.height;this.board.length=t*i,this.board.fill(0);let n=s=>{let o=typeof s=="number"?Math.trunc(s/t):s.y,a=typeof s=="number"?s-o*t:s.x;if(l(o>=0&&o<i&&a>=0&&a<t,"Mine position is outside the grid"),this.board[a+o*t]<0)throw new Error(`Same cell marked as mine more than once: {X: ${a}, y: ${o}}`);this.board[a+o*t]=-2;for(let d=Math.max(a-1,0);d<Math.min(a+2,t);d++)for(let h=Math.max(o-1,0);h<Math.min(o+2,i);h++)this.board[d+h*t]!==-2&&this.board[d+h*t]++};for(let s of e)n(s)}getBoardNumber(){if(this._boardNumber===void 0){let e=0n;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e<<=1n,this.board[i+t*this.width]<0&&(e|=1n);this._boardNumber=de(e,this.width*this.height)}return this._boardNumber}getCellValue(e,t){return this.board[e+t*this.width]}getValueMap(){return this.board}clearTransientState(){return this._boardNumber=void 0,this}toString(){let e=this.board;return e?Array.from({length:this.height}).map((t,i)=>Array.from({length:this.width}).map((n,s)=>e[s+i*this.width]).map(n=>n===-2?"X":String(n)).join("")).join(`
`):"Uninitialized"}};var y=class{cells=[];listeners=[];cellListener;openMines=0;minesRemaining=0;cellsRemaining=0;boardStarted=0;boardEnded=0;started=!1;view;clockEventInterval=0;timerId;constructor(e){this.cellListener=this.getCellListener(),this.reset(e),this.view=e}getCellVisibleState(e,t){return this.cells[e+t*this.view.width]?.getVisibleState()??-1}getCellListener(){return(e,t)=>{switch(t.type){case 0:if(e.isMine()){let i=this.openMines===0;this.openMines++,i&&(this.stopClock(),this.fireEvent(4,t.attributes))}else this.cellsRemaining--,this.started||(this.started=!0,this.startClock(),this.fireEvent(3,t.attributes)),this.cellsRemaining||(this.stopClock(),this.fireEvent(6,t.attributes));break;case 2:e.isFlagged()?this.minesRemaining--:this.minesRemaining++,this.fireEvent(8,t.attributes);break;case 1:e.isMine()?(this.openMines--,this.openMines||(this.startClock(),this.fireEvent(5,t.attributes))):this.cellsRemaining++||(this.startClock(),this.fireEvent(7,t.attributes));break}}}expandZeroGroup(e){let t=new Set,i=new Set;function n(){for(let s of i)return i.delete(s),s;throw new Error("Empty")}for(let s of z(e))i.add(s);for(;i.size;){let s=n(),{x:o,y:a}=s.position;if(t.add(s),this.view.getCellValue(o,a)===0)for(let h of s.getNeighbors())t.has(h)||i.add(h)}return t}getCell(e,t){return typeof e=="number"?t===void 0?(l(e>=0&&e<this.cells.length,"Index out of bounds"),this.cells[e]):(l(e>=0&&e<this.view.width&&t>=0&&t<this.view.height,"position outside grid"),this.cells[e+t*this.view.width]):this.cells[me(e,this.view.width,this.view.height)]}getAllCells(){return this.cells}getVisibleStateMap(){return this.cells.map(e=>e.getVisibleState())}isExploded(){return this.openMines>0}isComplete(){return this.started&&this.cellsRemaining<=0}getMinesRemaining(){return this.minesRemaining}getCellsRemaining(){return this.cellsRemaining}getTimeElapsed(){return this.boardStarted===0?0:this.boardEnded===0?Date.now()-this.boardStarted:this.boardEnded-this.boardStarted}setTimeElapsed(e,t){this.boardStarted=(this.boardEnded||Date.now())-e,this.startClock(t)}setClockEventInterval(e,t){this.clockEventInterval=e,e>0?this.startClock(t):this.stopClock(t)}startClock(e){this.timerId===void 0&&this.started&&this.boardEnded===0&&this.clockEventInterval>0&&(this.boardStarted=Date.now(),this.fireEvent(10,e),this.timerId=setInterval(()=>{this.fireEvent(10,e)},this.clockEventInterval))}stopClock(e){this.boardStarted!==0&&this.boardEnded===0&&(this.boardEnded=Date.now(),this.fireEvent(10,e)),this.timerId!==void 0&&(clearInterval(this.timerId),this.timerId=void 0)}reset(e,t){this.view=e;for(let s of this.getAllCells())s.dispose(t);let{width:i,height:n}=e;this.cells.length=i*n;for(let s=0;s<i;s++)for(let o=0;o<n;o++)(this.cells[s+o*i]=new U({x:s,y:o},this)).addListener(this.cellListener);this.initializeStats(),this.fireEvent(1,t)}getView(){return this.view}initializeStats(){this.openMines=0;let{width:e,height:t,mineCount:i}=this.getView();this.minesRemaining=i,this.cellsRemaining=e*t-i,this.boardStarted=0,this.boardEnded=0,this.stopClock(),this.started=!1}dispose(e){for(let t of this.cells)t.dispose();this.fireEvent(0,e),this.listeners.length=0,this.cells.length=0}openGroup(e,t){for(let i of z(e))i.isOpened()||i.openNoExpand();this.fireEvent(9,t)}addListener(e){this.listeners.push(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};var U=class{constructor(e,t){this.position=e;this.board=t}flagged=!1;value;opened=!1;pressed=!1;wrong=!1;listeners=[];attributes=new Map;neighbors=[];getVisibleState(){return this.opened?this.peek():this.flagged?-3:-1}isFlagged(){return this.flagged}isMine(){return this.peek()===-2}isOpened(){return this.opened}isPressed(){return this.pressed}isWrong(){return this.wrong}openNoExpand(e){return this.opened||(this.flag(!1),this.opened=!0,this.fireEvent(0,e)),this.peek()}open(e){this.board.openGroup(this.board.expandZeroGroup([this]),e)}peek(){return this.value===void 0&&(this.value=this.board.getView().getCellValue(this.position.x,this.position.y)),this.value}close(e){this.opened&&(this.fireEvent(1,e),this.opened=!1)}chord(e){if(!this.isOpened()||this.isMine())return;let t=0,i=[];this.getNeighbors().forEach(n=>{n.isFlagged()?t++:n.isOpened()||i.push(n)}),t===this.peek()&&this.board.openGroup(this.board.expandZeroGroup(i),e)}flag(e=!0,t){!this.isOpened()&&e!==this.flagged&&(this.flagged=e,this.fireEvent(2,t))}setWrong(e=!0,t){this.wrong!==e&&(this.wrong=e,this.fireEvent(3,t))}press(e=!0,t){this.isOpened()||this.isFlagged()||this.pressed!==e&&(this.pressed=e,this.fireEvent(6,t))}pressChord(e=!0,t){!this.isOpened()||this.isMine()||this.getNeighbors().forEach(i=>i.press(e,t))}pressCellOrChord(e=!0,t){this.isOpened()?this.pressChord(e,t):this.press(e,t)}getNeighbors(){if(!this.neighbors.length){let{x:e,y:t}=this.position,{width:i,height:n}=this.board.getView();for(let s=Math.max(e-1,0);s<Math.min(e+2,i);s++)for(let o=Math.max(t-1,0);o<Math.min(t+2,n);o++)(s!==e||o!==t)&&this.neighbors.push(this.board.getCell(s,o))}return this.neighbors}addListener(e){this.listeners.push(e)}reset(e){this.flagged=!1,this.opened=!1,this.pressed=!1,this.wrong=!1,this.value=void 0,this.fireEvent(4,e)}dispose(e){this.fireEvent(5,e),this.listeners.length=0,this.attributes.clear()}setAttribute(e,t){this.attributes.set(e,t)}getAttribute(e){return this.attributes.get(e)}clearAttribute(e){this.attributes.delete(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};var De=2;function Z(r,e,...t){if(r<=De){let i;switch(r){case 3:i=console.info;break;case 2:i=console.warn;break;case 1:i=console.error;break;default:i=console.log;break}i(e,...t.map(n=>typeof n=="function"?n():n))}}function f(r,...e){Z(5,r,...e)}function K(r,...e){Z(3,r,...e)}function q(r,...e){Z(1,r,...e)}function*Y(r){yield*Ve(r)}function*Ve(r){for(;!r.isClosed();)yield r.read()}var j=class{read(){throw new Error("End of stream")}readBatch(e=32){throw new Error("End of stream")}maxBatch(){return 1}readBigBits(e){throw new Error("End of stream")}count(){return 0}pending(){return 0}close(){}isClosed(){return!0}},ut=new j,E=class r{bits;_length=0;constructor(e,t){this.bits=Array.isArray(e)?e:e?[e]:[],this._length=this.bits.length*32,t!==void 0&&t!==this._length&&(this.length=t)}static fromBigint(e){let t=new r;return t.setBigBits(e,0),t}static fromReader(e,t){if(e instanceof D)return e.close(),e.bitset;t=t??-1;let i=new r,n=i.toWriter();function s(){return t<0?e.pending():t>0?Math.min(t,e.pending()):0}let o=s();for(;o;)n.writeBatch(e.readBatch(o),o),t-=o,o=s();return i}get length(){return this._length}set length(e){l(e>=0,"Length must be positive");let t=e+31>>>5;if(t>this.bits.length)for(let i=this.bits.length;i<t;i++)this.bits.push(0);else this.bits.length=t,e<this._length&&(this.bits[this.bits.length-1]&=4294967295>>>-(e&31));this._length=e}trim(){let e;for(e=this.bits.length;e>0&&!this.bits[e-1];--e);return this.bits.length=e,this._length=this.bits.length?(this.bits.length<<5)-Math.clz32(this.bits[this.bits.length-1]):0,this}getBit(e){if(l(e>=0,"Index out of range"),e>=this._length)return 0;let{bytePos:t,bitPos:i}=L(e);return this.bits[t]>>>i&1}setBit(e,t=1){l(e>=0,"Index out of range"),this._length<=e&&(this.length=e+1);let{bytePos:i,bitPos:n}=L(e),s=1<<n;t?this.bits[i]|=s:this.bits[i]&=~s}appendBit(e=1){this.setBit(this._length,e)}clearBit(e){this.setBit(e,0)}getBits(e,t){if(t=t??e+32,l(e>=0&&t>=e,"start or end out of range"),l(t-e<=32,"Too many bits requested - use getBigBits"),e>=this._length)return 0;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0;let{bytePos:n,bitPos:s}=L(e);return s===0&&i===32?this.bits[n]:s+i<=32?this.bits[n]>>>s&4294967295>>>-i:(this.bits[n]>>>s|this.bits[n+1]<<-s)&4294967295>>>-i}setBits(e,t,i){i=i??t+32,l(t>=0&&i>=t,"start or end out of range"),l(i-t<=32,"setting bits limited to 32 bits"),i===void 0&&(i=t+32),i>=this._length&&(this.length=i);let n=i-t;if(n===0)return;let{bytePos:s,bitPos:o}=L(t);if(o+n<=32){let a=4294967295>>>-n<<o;this.bits[s]=this.bits[s]&~a|e<<o&a}else{this.bits[s]=this.bits[s]&4294967295>>>-o|e<<o;let a=4294967295<<o+n;this.bits[s+1]=this.bits[s+1]&a|e>>-o&~a}}appendBits(e,t){if(typeof e=="bigint"){this.appendBigBits(e,t);return}return t=t??32,l(t>=0&&t<=32,"bitCount must be between 0 and 32"),this.setBits(e,this._length,this._length+t)}getBigBits(e,t){if(t=t??Math.max(e,this._length),l(e>=0&&t>=e,"start or end out of range"),e>=this._length)return 0n;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0n;let{bytePos:n,bitPos:s}=L(e);if(s+i<=32)return BigInt((this.bits[n]>>>s&4294967295>>>-i)>>>0);let o=BigInt(i),a=BigInt(this.bits[n]>>>s),d=32-s,h=n+1;for(;o>32+d;h++)a|=BigInt(this.bits[h]>>>0)<<BigInt(d),d+=32;return a|=BigInt((this.bits[h]&4294967295>>>d-i)>>>0)<<BigInt(d),a}setBigBits(e,t,i){if(l(t>=0&&(i===void 0||i>=t),"start or end out of range"),t===i)return 0;let n=t;i&&(e&=(1n<<BigInt(i-t))-1n,this.length=Math.max(this._length,i));let{bytePos:s,bitPos:o}=L(t);e<<=BigInt(o);let a=e<0;a&&(e=~e);let d=4294967295<<o>>>0;if(t+=32-o,e<=d&&(i||(i=Math.max(t-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),i<=t))return d=d<<-i>>>-i,this.bits[s]=this.bits[s]&~d|Number(a?~e:e)&d,i-n;for(o=0,this.length=Math.max(this._length,t),this.bits[s]=this.bits[s]&~d|Number((a?~e:e)&BigInt(d)),e>>=32n,s++;i?i-t>32:this._length-t>32||e>4294967295;)this.length=Math.max(this._length,t+32),this.bits[s++]=Number((a?~e:e)&0xffffffffn)|0,t+=32,e>>=32n;return i||(i=Math.max(t+32-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),d=4294967295>>>-i,this.bits[s]=this.bits[s]&~d|Number((a?~e:e)&BigInt(d)),i-n}appendBigBits(e,t){return this.setBigBits(e,this._length,t===void 0?t:this._length+t)}countBits(){return this.bits.reduce((e,t)=>e+ce(t),0)}shift(e){if(e<0){e=-e;let t=e>>>5,i=e&31;if(i===0)for(let n=0;n<this.bits.length-t;n++)this.bits[n]=this.bits[n+t];else{let n=0;for(;n<this.bits.length-t-1;n++)this.bits[n]=this.bits[n+t]>>>i|this.bits[n+t+1]<<-i;this.bits[n]=this.bits[n+t]>>>i}this.length-=e}else if(e>0){let t=e>>>5,i=e&31;if(this.length+=e+32,i===0)for(let n=this.bits.length-1;n>=t;n--)this.bits[n]=this.bits[n-t];else{for(let n=this.bits.length-1;n>t;n--)this.bits[n]=this.bits[n-t]<<i|this.bits[n-t-1]>>>-i;this.bits[t]=this.bits[0]<<i}this.length-=32}return this}toBigInt(e=0){return this.getBigBits(e,this._length)}toReader(e,t){return new D(this,e,t)}toWriter(e,t){return new v(this,e,t)}clone(){return new r([...this.bits],this._length)}[Symbol.iterator](){return Y(this.toReader())}toString(e=2){let t=this.toBigInt().toString(e);return"0".repeat(Math.max(Math.trunc(Math.log(2**this.length)/Math.log(e))-t.length,0))+t}};function L(r){return{bytePos:r>>>5,bitPos:r&31}}var X=class{constructor(e=-1){this.bitsAvailable=e}done=!1;read(){return l(!this.done,"End of stream"),this.bitsAvailable--,this.getBits(1)}readBatch(e=32){if(e===0)return 0;l(!this.done,"End of stream"),l(e>=0&&e<=32,"bitCount must be between 0 and 32 inclusive");try{return this.bitsAvailable-=e,this.getBits(e)}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}readBigBits(e){l(!this.done,"End of stream"),e=e??-1;try{let t=0n,i=0,n=this.pending();for(;e<0?n>0:e>i;){l(n>0,"End of stream");let s=e<0?n:Math.min(e-i,n);t|=BigInt(this.getBits(s)>>>0)<<BigInt(i),i+=s,this.bitsAvailable-=s,n=this.pending()}return t}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}maxBatch(){return 32}count(){return this.done?0:this.bitsAvailable<0?-1:this.bitsAvailable}pending(){return this.done?0:1}close(){this.done=!0}isClosed(){return this.done}asBigBitReader(){return{read:()=>this.read(),readBatch:e=>this.readBigBits(e),maxBatch:()=>4294967295,count:()=>this.count(),pending:()=>this.pending(),close:()=>this.close(),isClosed:()=>this.isClosed(),asBitReader:()=>this}}},D=class extends X{constructor(t,i=0,n){super();this.bitset=t;this.end=n;l(i>=0,"start must be non-negative"),l(n===void 0||n>=i,"end must be greater than start"),this.pos=i}pos;isClosed(){return this.done||this.pos>=(this.end??this.bitset.length)}getBits(t){l(this.pos+t<=(this.end??this.bitset.length),"No data available");let i=this.pos;return this.pos+=t,this.bitset.getBits(i,this.pos)}count(){return this.done?0:(this.end??this.bitset.length)-this.pos}pending(){let t=this.count(),i=32-(this.pos&31);return t>=0&&t<=i?t:i}},v=class{constructor(e=new E,t=e.length,i){this.end=i;l(t>=0,"start must be non-negative"),l(i===void 0||i>=t,"end must be greater than start"),this.bitset=e??new E,this.pos=t}bitset;pos;closed=!1;isClosed(){return this.closed||!!this.end&&this.pos>=this.end}write(e){return this.assertBitCount(1),this.bitset.setBit(this.pos,e),this.pos++,this}writeBatch(e,t){return t=t??32,this.assertBitCount(t),this.bitset.setBits(e,this.pos,this.pos+t),this.pos+=t,this}writeBigBits(e,t){return this.end!==void 0&&t===void 0&&(t=this.end-this.pos),this.assertBitCount(t??0),t===void 0?t=this.bitset.setBigBits(e,this.pos):this.bitset.setBigBits(e,this.pos,this.pos+t),this.pos+=t,this}close(){this.closed=!0}assertBitCount(e){l(!this.closed,"Stream is closed"),l(!this.end||this.pos+e<=this.end,"End of stream")}asBigBitWriter(){let e={write:t=>(this.write(t),e),writeBatch:(t,i)=>(this.writeBigBits(t,i),e),isClosed:()=>this.isClosed(),close:()=>this.close(),asBitWriter:()=>this};return e}};function be(r){let e=ge(r),t=ge(r.map(i=>[i[1],i[0]]));return{encode:e,decode:t}}function ge(r){let e=[void 0,void 0];for(let i of r){let[n,s]=i,o=e;for(let d=0;d<n.bitCount-1;d++){let h=n.value>>>d&1,u=o[h];if(!u)o[h]=u=[void 0,void 0];else if(!Array.isArray(u))throw new Error(`Found conflicting encode values. 0b${$({value:n.value&(1<<d)-1,bitCount:d})} is a prefix for 0b${$(n)}.`);o=u}let a=n.value>>>n.bitCount-1&1;if(o[a])throw new Error(`Found conflicting encode values. 0b${$(n)} is a prefix for another value.`);o[a]=s}function t(i,n=""){for(let s of[0,1]){let o=i[s];if(o)Array.isArray(o)&&t(o,n+s);else throw new Error(`Incomplete tree. No code for prefix: ${n}${s}.`)}}return t(e),e}function $(r){function e(t,i){return"0".repeat(Math.max(i-t.length,0))+t}return e(r.value.toString(2),r.bitCount)}var pe={encode:r=>r<0?~r<<1|1:r<<1,decode:r=>r&1?~(r>>>1):r>>>1},I=class r{constructor(e,t=0){this.base=e;this.min=t;l(t<=e)}static encode(e,t,i){return new r(t,i).encode(e)}static decode(e,t,i){return new r(t,i).decode(e)}encode(e){return l(e>=this.min),e>=2*(this.base-this.min)+this.min?e-this.min:pe.encode(e-this.base)}decode(e){return l(e>=0),e<2*(this.base-this.min)?pe.decode(e)+this.base:e+this.min}};var N=class{constructor(e,t){this.n=e;this.z=t;l(e>=0),l(t>=0&&t<=e),l(Math.trunc(e)===e&&Math.trunc(t)===t,"n and z must be integers")}encode(e,t){let i=this.n,n=this.z;for(let s of Y(e)){if(t.encodeBit(n/i,s),!--i)return;s||--n}}decode(e,t){let i=this.n,n=this.z;for(;i;--i){let s=e.decodeBit(n/i);t.write(s),s||--n}}},V=class{constructor(e,t=0){this.min=t;l(e>t),this.max=e-t-1>>>0,this.mask=e?1<<31-Math.clz32(this.max):0}max;mask;encodeValue(e,t){let i=this.mask,n=!1;for(e-=this.min,l(e>=0&&e<=this.max);i;){let s=n?.5:i/(i+(this.max&i?(this.max&i-1)+1:0)),o=e&i?1:0;t.encodeBit(s,o),n||=!o&&!!(this.max&i),i>>>=1}}decodeValue(e){let t=this.mask,i=!1,n=0;for(;t;){let s=i?.5:t/(t+(this.max&t?(this.max&t-1)+1:0)),o=e.decodeBit(s);n|=o*t,i||=!o&&!!(this.max&t),t>>>=1}return n+this.min}},x=class{constructor(e,t=.5){this.payloadBits=e;this.p=1-t}p;encode(e,t){if(this.payloadBits){for(let i=0;i<this.payloadBits;++i)t.encodeBit(.5,e.isClosed()?0:e.read());if(e.isClosed()){t.encodeBit(.5,0);return}t.encodeBit(.5,1)}for(;;){let i=e.isClosed()?0:e.read();if(e.isClosed()){t.encodeBit(this.p,0);return}t.encodeBit(this.p,1),t.encodeBit(.5,i)}}encodeValue(e,t){this.encode(new v().writeBatch(e).bitset.trim().toReader(),t)}encodeBigInt(e,t){this.encode(new v().writeBigBits(e).bitset.trim().toReader(),t)}decode(e,t){if(this.payloadBits){for(let n=0;n<this.payloadBits;++n)t.write(e.decodeBit(.5));if(!e.decodeBit(.5))return}for(;;){if(!e.decodeBit(this.p)){t.write(1);return}t.write(e.decodeBit(.5))}}decodeValue(e){let t=new E;return this.decode(e,t.toWriter()),l(t.trim().length<=32,"Value too large for a number. Use decodeBigInt"),t.getBits(0)}decodeBigInt(e){let t=new E;return this.decode(e,t.toWriter()),t.toBigInt()}asBigintCoder(){return{encode:(e,t)=>{this.encode(e,t)},decode:(e,t)=>{this.decode(e,t)},encodeValue:(e,t)=>this.encodeBigInt(e,t),decodeValue:e=>this.decodeBigInt(e)}}};function Ce(r){let e=r;l(typeof r=="object"&&!!r&&typeof e.height=="number"&&typeof e.width=="number"&&Array.isArray(e.cellData),"Invalid Board Info: "+JSON.stringify(r))}var Q=class r{static valueCoder=new x(4);static timeElapsedCoder=new x(7);encodeValue(e,t){let{height:i,width:n,elapsedTime:s}=e;i===16&&n===30?(t.encodeBit(.5,1),t.encodeBit(.5,1)):i===16&&n===16?(t.encodeBit(.5,1),t.encodeBit(.5,0)):i===9&&n===9?(t.encodeBit(.5,0),t.encodeBit(.5,1)):(t.encodeBit(.5,0),t.encodeBit(.5,0),r.valueCoder.encodeValue(i-1,t),r.valueCoder.encodeValue(I.encode(n,i,1),t)),s?(t.encodeBit(.5,1),r.timeElapsedCoder.encodeValue(Math.trunc(s/500),t)):t.encodeBit(.5,0)}decodeValue(e){let t=e.decodeBit(.5),i=e.decodeBit(.5),n,s;t===1&&i===1?(n=16,s=30):t==1&&i===0?(n=16,s=16):t===0&&i===1?(n=9,s=9):(n=r.valueCoder.decodeValue(e)+1,s=I.decode(r.valueCoder.decodeValue(e),n,1));let o=0;return e.decodeBit(.5)&&(o=r.timeElapsedCoder.decodeValue(e)*500),{width:s,height:n,elapsedTime:o}}},J=class{constructor(e,t){this.width=e;this.height=t;this.width===30&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=99):this.width===16&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=40):this.width===9&&this.height===9?(this.standardBoardSize=!0,this.expectedMineCount=10):(this.standardBoardSize=!1,this.expectedMineCount=Math.round(this.width*this.height/5));let i=Math.max(32-Math.clz32(this.width*this.height/20),1);this.customCoder=new x(i)}standardBoardSize;expectedMineCount;customCoder;encodeValue(e,t){if(this.standardBoardSize)if(this.expectedMineCount===e){t.encodeBit(.5,1);return}else t.encodeBit(.5,0);this.customCoder.encodeValue(I.encode(e,this.expectedMineCount),t)}decodeValue(e){return this.standardBoardSize&&e.decodeBit(.5)?this.expectedMineCount:I.decode(this.customCoder.decodeValue(e),this.expectedMineCount)}},W=class{cellCount;mineCountCoder;constructor(e,t){this.cellCount=e*t,this.mineCountCoder=new J(e,t)}encodeValue(e,t){let i=0;for(let n=0;n<this.cellCount;n++)e.getBit(n)&&i++;this.mineCountCoder.encodeValue(i,t),new N(this.cellCount,this.cellCount-i).encode(e.toReader(),t)}decodeValue(e){let t=this.mineCountCoder.decodeValue(e),i=new N(this.cellCount,this.cellCount-t),n=new E;return i.decode(e,n.toWriter()),n}},ee=class{constructor(e,t,i){this.width=e;this.height=t;this.mineField=i;this.cellCount=e*t,this.openCountCoder=new V(this.cellCount+1),this.flagCountCoder=new x(Math.max(32-Math.clz32(this.mineField.mineCount)-1,1)),this.openMineCountCoder=this.wrongFlagCountCoder=this.closedInOpenGroupCoder=new x(0)}cellCount;openCountCoder;openMineCountCoder;flagCountCoder;wrongFlagCountCoder;closedInOpenGroupCoder;encodeValue(e,t){this.openCountCoder.encodeValue(e.opened,t),this.openMineCountCoder.encodeValue(e.openMines+1,t),this.flagCountCoder.encodeValue(e.flags,t),this.wrongFlagCountCoder.encodeValue(e.wrongFlags+1,t),this.closedInOpenGroupCoder.encodeValue(e.closedInOpenGroup+1,t)}decodeValue(e){let t=this.openCountCoder.decodeValue(e),i=this.openMineCountCoder.decodeValue(e)-1,n=this.flagCountCoder.decodeValue(e),s=this.wrongFlagCountCoder.decodeValue(e)-1,o=this.closedInOpenGroupCoder.decodeValue(e)-1;return{cells:this.cellCount,mines:this.mineField.mineCount,opened:t,openMines:i,flags:n,wrongFlags:s,closedInOpenGroup:o}}},F=class{constructor(e,t,i){this.width=e;this.height=t;this.mineField=i;this.tallyCoder=new ee(e,t,i)}tallyCoder;encodeValue(e,t){f("[OpenStateCoder.encodeValue] encoding: %o",e);let i=He(this.width,this.height,this.mineField,e);if(i.opened===0&&i.flags===0){f("[OpenStateCoder.encodeValue] encoding closed board"),t.encodeBit(.5,0);return}else f("[OpenStateCoder.encodeValue] encoding tally: %o",i),t.encodeBit(.5,1),this.tallyCoder.encodeValue(i,t);let n=i.mines===0?1:i.cells===i.mines?0:i.flags/i.mines/(i.opened/(i.cells-i.mines)),s=new y(this.mineField),o=0;for(let a=0;a<this.height;a++)for(let d=0;d<this.width;d++,o++){let h=this.left(e,this.mineField,d,a),u=this.up(e,this.mineField,d,a),g=this.mineField.getCellValue(d,a)===-2,b=s.getCell(d,a).isOpened(),{pOpen:B,pFlag:S}=we([h,u].filter(R=>!!R),g,b,i,n),M=e[o]??0;f("[OpenStateCoder.encodeValue] encoding cell: %o",()=>({cellState:M,left:h,up:u,x:d,y:a,isMine:g,isInOpenGroup:b,flagRatio:n,pOpen:B,pFlag:S})),Pe(M,B,S,t),M===1&&s.getCell(d,a).openNoExpand(),te(i,g,e[o],b,-1)}}decodeValue(e){let t=e.decodeBit(.5),i=[];if(!t){for(let a=this.width*this.height;a>0;a--)i.push(0);return i}let n=this.tallyCoder.decodeValue(e),s=n.mines===0?1:n.cells===n.mines?0:n.flags/n.mines/(n.opened/(n.cells-n.mines)),o=new y(this.mineField);for(let a=0;a<this.height;a++)for(let d=0;d<this.width;d++){let h=this.left(i,this.mineField,d,a),u=this.up(i,this.mineField,d,a),g=this.mineField.getCellValue(d,a)===-2,b=o.getCell(d,a).isOpened(),{pOpen:B,pFlag:S}=we([h,u].filter(R=>!!R),g,b,n,s),M=Ge(B,S,e);i.push(M),M===1&&o.getCell(d,a).openNoExpand(),te(n,g,M,b,-1)}return i}neighbor(e,t,i,n,s,o){let a=i+s,d=n+o;if(!(a<0||a>=this.width||d<0||d>=this.height))return{isMine:t.getCellValue(a,d)===-2,openState:e[d*this.width+a]}}left(e,t,i,n){return this.neighbor(e,t,i,n,-1,0)}up(e,t,i,n){return this.neighbor(e,t,i,n,0,-1)}},Be=class r{static dimensionCoder=new Q;encodeValue(e,t){let{width:i,height:n,elapsedTime:s}=e,{minemap:o,openState:a}=We(e.cellData),d=C.createMineFieldWithMineMap(i,n,[...o].map(h=>!!h));r.dimensionCoder.encodeValue(e,t),new W(i,n).encodeValue(o,t),new F(i,n,d).encodeValue(a,t)}decodeValue(e){let{width:t,height:i,elapsedTime:n}=r.dimensionCoder.decodeValue(e),s=new W(t,i).decodeValue(e),o=C.createMineFieldWithMineMap(t,i,[...s].map(d=>!!d)),a=new F(t,i,o).decodeValue(e);return{width:t,height:i,elapsedTime:n,cellData:Fe(s,a)}}};function We(r){let e=new v,t=[];for(let i of r)e.write(i.isMine?1:0),t.push(i.openState??0);return{minemap:e.bitset,openState:t}}function Fe(r,e){let t=[];for(let i=0;i<e.length;i++)t.push({isMine:!!r.getBit(i),openState:e[i]});return t}function Pe(r,e,t,i){let n=r===0;i.encodeBit(Math.max(1-e-t,0),n?0:1),n||i.encodeBit(e/(e+t),r===2?1:0)}function Ge(r,e,t){return t.decodeBit(Math.max(1-r-e,0))?t.decodeBit(r/(r+e))?2:1:0}function He(r,e,t,i){let n={flags:0,opened:0,wrongFlags:0,openMines:0,mines:0,cells:0,closedInOpenGroup:0},s=new y(t),o=0;for(let a=0;a<e;a++)for(let d=0;d<r;d++,o++){let h=t.getCellValue(d,a)===-2,u=s.getCell(o).isOpened();i[o]===1&&s.getCell(o).openNoExpand(),te(n,h,i[o],u,1)}return n}function te(r,e,t,i,n){let s=t===2,o=t===1;r.cells+=n,s?(r.flags+=n,i&&(r.closedInOpenGroup+=n)):o?r.opened+=n:i&&(r.closedInOpenGroup+=n),e?(r.mines+=n,o&&(r.openMines+=n)):s&&(r.wrongFlags+=n)}function we(r,e,t,i,n){f("[pOpenState] %o",{neighbors:r,isMine:e,isInOpenGroup:t,tally:i,flagRatio:n});let s=i.opened-i.openMines,o=i.cells-i.mines,a=e?i.openMines/i.mines:s/o,d=e?(i.flags-i.wrongFlags)/i.mines:i.wrongFlags/o;if(a===1||d===1||a===0&&d===0)return{pOpen:a,pFlag:d};if(t)return{pOpen:(o-i.closedInOpenGroup)/o,pFlag:Math.min(i.wrongFlags,i.closedInOpenGroup/2)/o};{let h=r.length,u=0,g=0;for(let B of r)B?.openState&&u++,B.isMine&&!B?.openState&&g++;h-=g*Math.max(1-n,0);let b=h===0?.5:u/h;return f("[pOpenState] weighting neighbor %o",{neighborOpenWeight:b,pFlag:d,pOpen:a}),b<=.5?e?d=Math.pow(d,(.5-b)*4+1):a=Math.pow(a,(.5-b)*4+1):e?(d=1-Math.pow(1-d,(b-.5)*4+1),a=Math.min(a,(1-d)/2)):(a=1-Math.pow(1-a,(b-.5)*4+1),d=Math.min(d,(1-a)/2)),{pOpen:a,pFlag:d}}}var qt=be([[{value:0,bitCount:3},{value:0,bitCount:1}],[{value:4,bitCount:3},{value:1,bitCount:3}],[{value:2,bitCount:3},{value:5,bitCount:3}],[{value:6,bitCount:3},{value:7,bitCount:5}],[{value:1,bitCount:3},{value:3,bitCount:3}],[{value:5,bitCount:3},{value:23,bitCount:5}],[{value:3,bitCount:3},{value:15,bitCount:5}],[{value:7,bitCount:3},{value:31,bitCount:5}]]);var P=class{worker;encodeListeners=new Set;decodeListeners=new Set;statsListeners=new Set;boardListeners=new Map;terminated=!1;lastEncoded;constructor(){K("[BoardIdWorker] Starting Board ID worker");let e;if(!ie.startsWith("<<")&&!ie.endsWith(">>")){let t=new Blob([ie],{type:"text/javascript"});e=URL.createObjectURL(t)}else e="../lib/ui/board_id_worker_entry.js";this.worker=new Worker(e,{type:"module",name:"BoardIdWorker"}),this.worker.onerror=t=>{q(`[BoardIdWorker.worker.onerror] Got error. Message: %o
Error: %o
filename: %o
lineno: %o
event: %o`,t.message,t.error,t.filename,t.lineno,t)},this.worker.onmessageerror=t=>{q("[BoardIdWorker.worker.onerror] Got error. Data: %oevent: %o",t.data,t)},this.worker.onmessage=t=>{f("[BoardIdWorker.worker.onmessage] Message to worker received: %o",t);let i=t.data;switch(i.messageType){case"DECODE":let{boardInfo:n}=i;Ce(n),this.decodeListeners.forEach(a=>a.handleDecodeResponse(n));break;case"ENCODE":let{boardId:s}=i;l(typeof s=="string","Invalid board id: "+JSON.stringify(s)),this.encodeListeners.forEach(a=>a.handleEncodeResponse(s));break;case"STATS":let{stats:o}=i;l(o,"Stats not found in response"),this.statsListeners.forEach(a=>a.handleStatsResponse(o));break;default:throw new Error("Unrecognized message response type: "+JSON.stringify(i))}},K("[BoardIdWorker] Board ID worker initialized")}requestEncode(e){l(!this.terminated,"BoardIdWorker has been terminated");let t=e.getView();if(this.lastEncoded?.view===t)for(let n of this.encodeListeners)n.handleEncodeResponse;let i=ve(e);f("[BoardIdWorker.requestEncode] Sending encode request: %o",i),this.worker.postMessage({messageType:"ENCODE",boardInfo:i})}requestDecode(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.requestDecode] Sending decode request: %o",e),this.worker.postMessage({messageType:"DECODE",boardId:e})}requestStats(e){l(!this.terminated,"BoardIdWorker has been terminated");let t=Date.now(),i=ve(e),n=Date.now();f("[BoardIdWorker.requestStats] Sending encode request: %o",i);let s=Date.now();this.worker.postMessage({messageType:"STATS",boardInfo:i});let o=Date.now()}addEncodeListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.addEncodeListener]"),this.encodeListeners.add(e)}removeEncodeListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.removeEncodeListener]"),this.encodeListeners.delete(e)}addDecodeListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.addDecodeListener]"),this.decodeListeners.add(e)}removeDecodeListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.removeDecodeListener]"),this.decodeListeners.delete(e)}addDecodeToBoardListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.addDecodeToBoardListener]");let t={handleDecodeResponse:i=>{let n=_e(i),s=!fe(n,e.getView());s&&e.reset(n,{DECODING:!0});let o=new Set;for(let a=0;a<i.cellData.length;a++){let d=e.getCell(a);switch(d.setWrong(!1,{DECODING:!0}),i.cellData[a].openState){case 1:d.isMine()?o.add(d):d.openNoExpand({DECODING:!0});break;case 2:d.close({DECODING:!0}),d.flag(!0,{DECODING:!0});break;default:d.close({DECODING:!0}),d.flag(!1,{DECODING:!0});break}}e.openGroup(o,{DECODING:!0}),s&&e.setTimeElapsed(i.elapsedTime,{DECODING:!0})}};this.removeDecodeToBoardListener(e),this.boardListeners.set(e,t),this.addDecodeListener(t)}removeDecodeToBoardListener(e){let t=this.boardListeners.get(e);t&&(this.removeDecodeListener(t),this.boardListeners.delete(e))}addStatsListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.addStatsListener]"),this.statsListeners.add(e)}removeStatsListener(e){l(!this.terminated,"BoardIdWorker has been terminated"),f("[BoardIdWorker.removeStatsListener]"),this.statsListeners.delete(e)}terminate(){this.terminated=!0,this.encodeListeners.clear(),this.decodeListeners.clear(),this.statsListeners.clear(),this.boardListeners.clear(),this.worker.terminate()}};function _e(r){let{width:e,height:t,cellData:i}=r;return C.createMineFieldWithMineMap(e,t,i.map(n=>n.isMine))}function ve(r){let e=r.getTimeElapsed(),t=r.getView(),{width:i,height:n}=t,s=r.getAllCells().map(o=>({isMine:t.getCellValue(o.position.x,o.position.y)===-2,openState:o.isOpened()?1:o.isFlagged()?2:0}));return{width:i,height:n,elapsedTime:e,cellData:s}}var ie=
'"use strict";(()=>{function d(r,e){if(!r)throw new Error(e??`Assertion failed: ${r}`);return r}var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",$=new Array(128);for(let r=0;r<k.length;r++)$[k.charCodeAt(r)]=r;function Y(r){let e=[],t=0,i=0;for(;;){let n=Math.min(6-i,r.pending());if(t|=r.readBatch(n)<<i,i+=n,(i===6||i>0&&n===0)&&(e.push(k[t]),t=0,i=0),!n)return e.join("")}}function q(r,e){for(let t of r)e.writeBatch($[t.charCodeAt(0)],6)}function J(r){return r=(r>>>0)-(r>>>1&1431655765),r=(r&858993459)+(r>>>2&858993459),(r+(r>>>4)&252645135)*16843009>>>24}function ce(r){return!!r[Symbol.iterator]}function W(r){return ce(r)?r:{[Symbol.iterator]:()=>r,length:r.length}}function*F(r){yield*me(r)}function*me(r){for(;!r.isClosed();)yield r.read()}var D=class{read(){throw new Error("End of stream")}readBatch(e=32){throw new Error("End of stream")}maxBatch(){return 1}readBigBits(e){throw new Error("End of stream")}count(){return 0}pending(){return 0}close(){}isClosed(){return!0}},ke=new D,b=class r{bits;_length=0;constructor(e,t){this.bits=Array.isArray(e)?e:e?[e]:[],this._length=this.bits.length*32,t!==void 0&&t!==this._length&&(this.length=t)}static fromBigint(e){let t=new r;return t.setBigBits(e,0),t}static fromReader(e,t){if(e instanceof y)return e.close(),e.bitset;t=t??-1;let i=new r,n=i.toWriter();function o(){return t<0?e.pending():t>0?Math.min(t,e.pending()):0}let s=o();for(;s;)n.writeBatch(e.readBatch(s),s),t-=s,s=o();return i}get length(){return this._length}set length(e){d(e>=0,"Length must be positive");let t=e+31>>>5;if(t>this.bits.length)for(let i=this.bits.length;i<t;i++)this.bits.push(0);else this.bits.length=t,e<this._length&&(this.bits[this.bits.length-1]&=4294967295>>>-(e&31));this._length=e}trim(){let e;for(e=this.bits.length;e>0&&!this.bits[e-1];--e);return this.bits.length=e,this._length=this.bits.length?(this.bits.length<<5)-Math.clz32(this.bits[this.bits.length-1]):0,this}getBit(e){if(d(e>=0,"Index out of range"),e>=this._length)return 0;let{bytePos:t,bitPos:i}=C(e);return this.bits[t]>>>i&1}setBit(e,t=1){d(e>=0,"Index out of range"),this._length<=e&&(this.length=e+1);let{bytePos:i,bitPos:n}=C(e),o=1<<n;t?this.bits[i]|=o:this.bits[i]&=~o}appendBit(e=1){this.setBit(this._length,e)}clearBit(e){this.setBit(e,0)}getBits(e,t){if(t=t??e+32,d(e>=0&&t>=e,"start or end out of range"),d(t-e<=32,"Too many bits requested - use getBigBits"),e>=this._length)return 0;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0;let{bytePos:n,bitPos:o}=C(e);return o===0&&i===32?this.bits[n]:o+i<=32?this.bits[n]>>>o&4294967295>>>-i:(this.bits[n]>>>o|this.bits[n+1]<<-o)&4294967295>>>-i}setBits(e,t,i){i=i??t+32,d(t>=0&&i>=t,"start or end out of range"),d(i-t<=32,"setting bits limited to 32 bits"),i===void 0&&(i=t+32),i>=this._length&&(this.length=i);let n=i-t;if(n===0)return;let{bytePos:o,bitPos:s}=C(t);if(s+n<=32){let a=4294967295>>>-n<<s;this.bits[o]=this.bits[o]&~a|e<<s&a}else{this.bits[o]=this.bits[o]&4294967295>>>-s|e<<s;let a=4294967295<<s+n;this.bits[o+1]=this.bits[o+1]&a|e>>-s&~a}}appendBits(e,t){if(typeof e=="bigint"){this.appendBigBits(e,t);return}return t=t??32,d(t>=0&&t<=32,"bitCount must be between 0 and 32"),this.setBits(e,this._length,this._length+t)}getBigBits(e,t){if(t=t??Math.max(e,this._length),d(e>=0&&t>=e,"start or end out of range"),e>=this._length)return 0n;t=Math.min(t,this._length);let i=t-e;if(i===0)return 0n;let{bytePos:n,bitPos:o}=C(e);if(o+i<=32)return BigInt((this.bits[n]>>>o&4294967295>>>-i)>>>0);let s=BigInt(i),a=BigInt(this.bits[n]>>>o),l=32-o,h=n+1;for(;s>32+l;h++)a|=BigInt(this.bits[h]>>>0)<<BigInt(l),l+=32;return a|=BigInt((this.bits[h]&4294967295>>>l-i)>>>0)<<BigInt(l),a}setBigBits(e,t,i){if(d(t>=0&&(i===void 0||i>=t),"start or end out of range"),t===i)return 0;let n=t;i&&(e&=(1n<<BigInt(i-t))-1n,this.length=Math.max(this._length,i));let{bytePos:o,bitPos:s}=C(t);e<<=BigInt(s);let a=e<0;a&&(e=~e);let l=4294967295<<s>>>0;if(t+=32-s,e<=l&&(i||(i=Math.max(t-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),i<=t))return l=l<<-i>>>-i,this.bits[o]=this.bits[o]&~l|Number(a?~e:e)&l,i-n;for(s=0,this.length=Math.max(this._length,t),this.bits[o]=this.bits[o]&~l|Number((a?~e:e)&BigInt(l)),e>>=32n,o++;i?i-t>32:this._length-t>32||e>4294967295;)this.length=Math.max(this._length,t+32),this.bits[o++]=Number((a?~e:e)&0xffffffffn)|0,t+=32,e>>=32n;return i||(i=Math.max(t+32-Math.clz32(Number(e)),this._length),this.length=Math.max(this._length,i)),l=4294967295>>>-i,this.bits[o]=this.bits[o]&~l|Number((a?~e:e)&BigInt(l)),i-n}appendBigBits(e,t){return this.setBigBits(e,this._length,t===void 0?t:this._length+t)}countBits(){return this.bits.reduce((e,t)=>e+J(t),0)}shift(e){if(e<0){e=-e;let t=e>>>5,i=e&31;if(i===0)for(let n=0;n<this.bits.length-t;n++)this.bits[n]=this.bits[n+t];else{let n=0;for(;n<this.bits.length-t-1;n++)this.bits[n]=this.bits[n+t]>>>i|this.bits[n+t+1]<<-i;this.bits[n]=this.bits[n+t]>>>i}this.length-=e}else if(e>0){let t=e>>>5,i=e&31;if(this.length+=e+32,i===0)for(let n=this.bits.length-1;n>=t;n--)this.bits[n]=this.bits[n-t];else{for(let n=this.bits.length-1;n>t;n--)this.bits[n]=this.bits[n-t]<<i|this.bits[n-t-1]>>>-i;this.bits[t]=this.bits[0]<<i}this.length-=32}return this}toBigInt(e=0){return this.getBigBits(e,this._length)}toReader(e,t){return new y(this,e,t)}toWriter(e,t){return new g(this,e,t)}clone(){return new r([...this.bits],this._length)}[Symbol.iterator](){return F(this.toReader())}toString(e=2){let t=this.toBigInt().toString(e);return"0".repeat(Math.max(Math.trunc(Math.log(2**this.length)/Math.log(e))-t.length,0))+t}};function C(r){return{bytePos:r>>>5,bitPos:r&31}}var L=class{constructor(e=-1){this.bitsAvailable=e}done=!1;read(){return d(!this.done,"End of stream"),this.bitsAvailable--,this.getBits(1)}readBatch(e=32){if(e===0)return 0;d(!this.done,"End of stream"),d(e>=0&&e<=32,"bitCount must be between 0 and 32 inclusive");try{return this.bitsAvailable-=e,this.getBits(e)}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}readBigBits(e){d(!this.done,"End of stream"),e=e??-1;try{let t=0n,i=0,n=this.pending();for(;e<0?n>0:e>i;){d(n>0,"End of stream");let o=e<0?n:Math.min(e-i,n);t|=BigInt(this.getBits(o)>>>0)<<BigInt(i),i+=o,this.bitsAvailable-=o,n=this.pending()}return t}catch(t){throw this.bitsAvailable=0,this.done=!0,t}}maxBatch(){return 32}count(){return this.done?0:this.bitsAvailable<0?-1:this.bitsAvailable}pending(){return this.done?0:1}close(){this.done=!0}isClosed(){return this.done}asBigBitReader(){return{read:()=>this.read(),readBatch:e=>this.readBigBits(e),maxBatch:()=>4294967295,count:()=>this.count(),pending:()=>this.pending(),close:()=>this.close(),isClosed:()=>this.isClosed(),asBitReader:()=>this}}},y=class extends L{constructor(t,i=0,n){super();this.bitset=t;this.end=n;d(i>=0,"start must be non-negative"),d(n===void 0||n>=i,"end must be greater than start"),this.pos=i}pos;isClosed(){return this.done||this.pos>=(this.end??this.bitset.length)}getBits(t){d(this.pos+t<=(this.end??this.bitset.length),"No data available");let i=this.pos;return this.pos+=t,this.bitset.getBits(i,this.pos)}count(){return this.done?0:(this.end??this.bitset.length)-this.pos}pending(){let t=this.count(),i=32-(this.pos&31);return t>=0&&t<=i?t:i}},g=class{constructor(e=new b,t=e.length,i){this.end=i;d(t>=0,"start must be non-negative"),d(i===void 0||i>=t,"end must be greater than start"),this.bitset=e??new b,this.pos=t}bitset;pos;closed=!1;isClosed(){return this.closed||!!this.end&&this.pos>=this.end}write(e){return this.assertBitCount(1),this.bitset.setBit(this.pos,e),this.pos++,this}writeBatch(e,t){return t=t??32,this.assertBitCount(t),this.bitset.setBits(e,this.pos,this.pos+t),this.pos+=t,this}writeBigBits(e,t){return this.end!==void 0&&t===void 0&&(t=this.end-this.pos),this.assertBitCount(t??0),t===void 0?t=this.bitset.setBigBits(e,this.pos):this.bitset.setBigBits(e,this.pos,this.pos+t),this.pos+=t,this}close(){this.closed=!0}assertBitCount(e){d(!this.closed,"Stream is closed"),d(!this.end||this.pos+e<=this.end,"End of stream")}asBigBitWriter(){let e={write:t=>(this.write(t),e),writeBatch:(t,i)=>(this.writeBigBits(t,i),e),isClosed:()=>this.isClosed(),close:()=>this.close(),asBitWriter:()=>this};return e}};var fe=2;function be(r,e,...t){if(r<=fe){let i;switch(r){case 3:i=console.info;break;case 2:i=console.warn;break;case 1:i=console.error;break;default:i=console.log;break}i(e,...t.map(n=>typeof n=="function"?n():n))}}function c(r,...e){be(5,r,...e)}var R=class{static encoder(e){return new G(e)}static decoder(e,t){return new P(e,t)}};function ge(r,e,t,i=!0){r=Array.isArray(r)?r:[r];let n=R.encoder(t);for(let o of r)e.encodeValue(o,n);n.close(i)}function ee(r,e,t){let i=t?t.bitset:new b,n=t??i.toWriter();return ge(r,e,n,!!t),i}function te(r,e,t=!0){let i=R.decoder(r,t),n=e.decodeValue(i);return i.close(),n}var x=class{constructor(e,t){this.n=e;this.z=t;d(e>=0),d(t>=0&&t<=e),d(Math.trunc(e)===e&&Math.trunc(t)===t,"n and z must be integers")}encode(e,t){let i=this.n,n=this.z;for(let o of F(e)){if(t.encodeBit(n/i,o),!--i)return;o||--n}}decode(e,t){let i=this.n,n=this.z;for(;i;--i){let o=e.decodeBit(n/i);t.write(o),o||--n}}},I=class{constructor(e,t=0){this.min=t;d(e>t),this.max=e-t-1>>>0,this.mask=e?1<<31-Math.clz32(this.max):0}max;mask;encodeValue(e,t){let i=this.mask,n=!1;for(e-=this.min,d(e>=0&&e<=this.max);i;){let o=n?.5:i/(i+(this.max&i?(this.max&i-1)+1:0)),s=e&i?1:0;t.encodeBit(o,s),n||=!s&&!!(this.max&i),i>>>=1}}decodeValue(e){let t=this.mask,i=!1,n=0;for(;t;){let o=i?.5:t/(t+(this.max&t?(this.max&t-1)+1:0)),s=e.decodeBit(o);n|=s*t,i||=!s&&!!(this.max&t),t>>>=1}return n+this.min}},B=class{constructor(e,t=.5){this.payloadBits=e;this.p=1-t}p;encode(e,t){if(this.payloadBits){for(let i=0;i<this.payloadBits;++i)t.encodeBit(.5,e.isClosed()?0:e.read());if(e.isClosed()){t.encodeBit(.5,0);return}t.encodeBit(.5,1)}for(;;){let i=e.isClosed()?0:e.read();if(e.isClosed()){t.encodeBit(this.p,0);return}t.encodeBit(this.p,1),t.encodeBit(.5,i)}}encodeValue(e,t){this.encode(new g().writeBatch(e).bitset.trim().toReader(),t)}encodeBigInt(e,t){this.encode(new g().writeBigBits(e).bitset.trim().toReader(),t)}decode(e,t){if(this.payloadBits){for(let n=0;n<this.payloadBits;++n)t.write(e.decodeBit(.5));if(!e.decodeBit(.5))return}for(;;){if(!e.decodeBit(this.p)){t.write(1);return}t.write(e.decodeBit(.5))}}decodeValue(e){let t=new b;return this.decode(e,t.toWriter()),d(t.trim().length<=32,"Value too large for a number. Use decodeBigInt"),t.getBits(0)}decodeBigInt(e){let t=new b;return this.decode(e,t.toWriter()),t.toBigInt()}asBigintCoder(){return{encode:(e,t)=>{this.encode(e,t)},decode:(e,t)=>{this.decode(e,t)},encodeValue:(e,t)=>this.encodeBigInt(e,t),decodeValue:e=>this.decodeBigInt(e)}}};var P=class{constructor(e,t=!1){this.input=e;this.padStream=t}closed=!1;high=2;low=1;value=1;valueRange=1;decodeBit(e){for(d(!this.closed,"Stream closed");this.high-this.low<=.25;){let n;this.high<=1.5?(this.high=(this.high-.5)*2,this.value=(this.value-.5)*2,this.low=(this.low-.5)*2,n="low"):this.low>=1.5?(this.high=(this.high-1)*2,this.value=(this.value-1)*2,this.low=(this.low-1)*2,n="high"):(this.high=(this.high-.75)*2,this.value=(this.value-.75)*2,this.low=(this.low-.75)*2,n="mid"),this.valueRange*=2,c("[Arithmetic.decode] zooming %o",()=>({zoom:n,low:this.low,high:this.high,value:this.value,valueRange:this.valueRange}))}let t=ie(this.low,this.high,e,"decode"),i=()=>({low:this.low,mid:t,high:this.high,value:this.value,valueRange:this.valueRange,p:e});for(c("[Arithmetic.decode] working on: %o",i);;){if(this.value>=t)return c("[Arithmetic.decode] emitting 1 bit. Data: %o",i),this.low=t,1;if(this.value+this.valueRange<=t)return c("[Arithmetic.decode] emitting 0 bit. Data: %o",i),this.high=t,0;{!this.padStream&&this.input.isClosed()&&(this.closed=!0,d(!1,"No more bits in the stream"));let n=this.padStream&&this.input.isClosed()?0:this.input.read();this.valueRange/=2,this.value+=n*this.valueRange,c("[Arithmetic.decode] Reading more. Data: %o",()=>({bit:n,...i()}))}}}close(){this.closed=!0}isClosed(){return this.closed}},G=class r{constructor(e,t){this.output=e;t&&(this.closed=t.closed,this.high=t.high,this.low=t.low,this.pendingBits=t.pendingBits,this.trailingZeros=t.trailingZeros)}closed=!1;high=2;low=1;pendingBits=0;trailingZeros=0;encodeBit(e,t){for(d(!this.closed,"Stream closed");this.high-this.low<=.25;)this.high<=1.5?this.zoomLow("encode"):this.low>=1.5?this.zoomHigh("encode"):this.zoomMid("encode");let i=ie(this.low,this.high,e,"encode");c("[Arithmetic.encode] working on: %o",()=>({low:this.low,mid:i,high:this.high,p:e,b:t})),t?(d(i<this.high,"[Arithmetic.encode] Invalid p == 1 with b === 1"),this.low=i):(d(i>this.low,"[Arithmetic.encode] Invalid p == 0 with b === 0"),this.high=i)}close(e=!1){if(!this.closed)if(this.closed=!0,e){for(;this.high<2||this.low>1;)this.low>1&&this.high>=1.75?this.zoomHigh("terminating"):this.high<2&&this.low<=1.25?this.zoomLow("terminating"):this.zoomMid("terminating");for(this.pendingBits&&(this.writeBit(1),c("[Arithmetic.close] Terminating pending: 1"));this.trailingZeros;--this.trailingZeros)this.output.write(0)}else for(;this.low>1||this.pendingBits;)this.high>1.5?this.zoomHigh("closing"):this.zoomLow("closing")}isClosed(){return this.closed}clone(e){return new r(e,{closed:this.closed,high:this.high,low:this.low,pendingBits:this.pendingBits,trailingZeros:this.trailingZeros})}zoomHigh(e){this.writeBit(1),this.high=(this.high-1)*2,this.low=(this.low-1)*2,c("[Arithmetic.zoom] %s %o",e,()=>({zoom:"high",low:this.low,high:this.high}))}zoomLow(e){this.writeBit(0),this.high=(this.high-.5)*2,this.low=(this.low-.5)*2,c("[Arithmetic.zoom] %s %o",e,()=>({zoom:"low",low:this.low,high:this.high}))}zoomMid(e){this.pendingBits++,this.high=(this.high-.75)*2,this.low=(this.low-.75)*2,c("[Arithmetic.zoom] %s %o",e,()=>({zoom:"mid",low:this.low,high:this.high}))}writeBit(e){if(e){for(;this.trailingZeros;--this.trailingZeros)this.output.write(0);this.output.write(1),this.trailingZeros=this.pendingBits,this.pendingBits=0}else{if(this.pendingBits){for(;this.trailingZeros>=0;--this.trailingZeros)this.output.write(0);for(;this.pendingBits;--this.pendingBits)this.output.write(1)}++this.trailingZeros}}};function ie(r,e,t,i){let n=r+t*(e-r);if(n>=e||isNaN(n)){if(n===e)return t<1?e-Number.EPSILON:e;throw new Error(`[Arithmetic.${i}] Invalid probablility from model: ${t}`)}if(n<=r||isNaN(n)){if(n===r)return t>0?r+Number.EPSILON:r;throw new Error(`[Arithmetic.${i}] Invalid probablility from model: ${t}`)}return n}function re(r){let e=ne(r),t=ne(r.map(i=>[i[1],i[0]]));return{encode:e,decode:t}}function ne(r){let e=[void 0,void 0];for(let i of r){let[n,o]=i,s=e;for(let l=0;l<n.bitCount-1;l++){let h=n.value>>>l&1,u=s[h];if(!u)s[h]=u=[void 0,void 0];else if(!Array.isArray(u))throw new Error(`Found conflicting encode values. 0b${H({value:n.value&(1<<l)-1,bitCount:l})} is a prefix for 0b${H(n)}.`);s=u}let a=n.value>>>n.bitCount-1&1;if(s[a])throw new Error(`Found conflicting encode values. 0b${H(n)} is a prefix for another value.`);s[a]=o}function t(i,n=""){for(let o of[0,1]){let s=i[o];if(s)Array.isArray(s)&&t(s,n+o);else throw new Error(`Incomplete tree. No code for prefix: ${n}${o}.`)}}return t(e),e}function H(r){function e(t,i){return"0".repeat(Math.max(i-t.length,0))+t}return e(r.value.toString(2),r.bitCount)}var oe={encode:r=>r<0?~r<<1|1:r<<1,decode:r=>r&1?~(r>>>1):r>>>1},v=class r{constructor(e,t=0){this.base=e;this.min=t;d(t<=e)}static encode(e,t,i){return new r(t,i).encode(e)}static decode(e,t,i){return new r(t,i).decode(e)}encode(e){return d(e>=this.min),e>=2*(this.base-this.min)+this.min?e-this.min:oe.encode(e-this.base)}decode(e){return d(e>=0),e<2*(this.base-this.min)?oe.decode(e)+this.base:e+this.min}};function pe(r,e){if(d(e<=r&&r>=0&&e>=0),r-e<e&&(e=r-e),e===0)return 1n;let t=BigInt(r);for(let i=t-1n,n=2n;n<=e;i--,n++)t*=i,t/=n;return t}function se(r,e){d(r>=0,"val must be positive"),d(e>0,"n must be positive");let t=0n,i=1n,n=0n,o=0n;for(let s=0;s<e;s++,r>>=1n)r&1n?(t-=i,i*=++n,i/=++o,t+=i):(i*=++n,i/=n-o);return d(r===0n,"val out of range"),t}function ae(r,e,t){let i=pe(e,t);d(r>=0n&&r<i,"BoardNumber out of range");let n=BigInt(e),o=BigInt(t),s=0n;for(let a=0;a<e;a++){s<<=1n;let l=i*(n-o)/n;r<l?i=l:(s|=1n,r-=i,i*=o--,i/=n,r+=i),n--}return s}var _=class{nextIntegers=new Uint32Array(16);nextIndex=16;next(){return this.nextIndex>=this.nextIntegers.length&&(crypto.getRandomValues(this.nextIntegers),this.nextIndex=0),this.nextIntegers[this.nextIndex++]}},A=class{constructor(e=new _){this.bitSource=e}workingBits=0;availableBits=0;getRandomBits(e){if(d(e>=0&&e<=32,"Random bits must be between 0 and 32"),e===32)return this.bitSource.next()>>>0;let t=0;return this.availableBits<e&&(t=this.workingBits<<e-this.availableBits,e-=this.availableBits,this.workingBits=this.bitSource.next()>>>0,this.availableBits=32),t|=this.workingBits>>>this.availableBits-e,this.availableBits-=e,this.workingBits&=(1<<this.availableBits)-1,t}getRandomInteger(e,t=0){d(t<=e,"Min must be <= max"),e-=t;let i=le(e),n;do n=this.getRandomBits(i);while(n>=e);return n+t}getRandomBigBits(e){d(e>=0,"BitLength must be positive");let t=0n;for(;e>32;)t=t<<32n|BigInt(this.getRandomBits(32)),e-=32n;return t=t<<BigInt(e)|BigInt(this.getRandomBits(Number(e))),t}getRandomBigInteger(e,t=0n){d(t<=e,"Min must be >= 0 and <= max"),e-=t;let i=le(e),n;do n=this.getRandomBigBits(i);while(n>=e);return n+t}getRandomDouble(){let e=new ArrayBuffer(8),t=new Uint32Array(e);return t[0]=this.getRandomBits(32),t[1]=this.getRandomBits(20)|1072693248,new Float64Array(e)[0]-1}};function de(r,e=r.length,t=Ce){for(let i=0;i<e;i++){let n=t.getRandomInteger(r.length,i);if(i!=n){let o=r[i];r[i]=r[n],r[n]=o}}return r.length=e,r}function le(r){return typeof r=="number"?32-Math.clz32(r-1):BigInt((r-1n).toString(2).length)}var z=class{random;constructor(e){e=(e??Date.now())&4294967295,console.log("Using Test seed: %d",e),this.random=Be(e)}next(){return Math.trunc(this.random()*4294967295)}};function Be(r){r^=3735928559;let e=we(2654435769,608135816,3084996962,r);for(let t=0;t<15;t++)e();return e}function we(r,e,t,i){return function(){r|=0,e|=0,t|=0,i|=0;let n=(r+e|0)+i|0;return i=i+1|0,r=e^e>>>9,e=t+(t<<3)|0,t=t<<21|t>>>11,t=t+n|0,(n>>>0)/4294967296}}function ve(){if(typeof jasmine>"u")return;let r=jasmine?.getEnv()?.configuration()?.seed;if(r)return typeof r=="string"&&(r=Number(r)),isNaN(r)?void 0:r}var Ce=new A,dt=new A(new z(ve()));function he(r,e,t){return typeof r=="number"?r:(d(r.x>=0&&r.x<e&&r.y>=0&&r.y<t,"position outside grid"),r.y*e+r.x)}var E=class r{constructor(e,t,i){this.width=e;this.height=t;d(e>0&&t>0,"Width and height must be positive values"),d(i.length<=e*t,"Mine count must be <= cell count"),this.mineCount=i.length,this.initBoard(i)}mineCount;board=[];_boardNumber;static createRandomMineField(e,t,i,n,o){let s=e*t,a=new Set;for(let h of n?.map(u=>he(u,e,t))??[])d(!a.has(h),"reserved cell already added"),a.add(h);d(i<=s-a.size,"Not enough room for the requested number of mines");let l=de(Array.from({length:s},(h,u)=>u).filter(h=>!a.has(h)),i,o);return new r(e,t,l)}static createRandomMineFieldWithOpening(e,t,i,n,o=2,s){let{x:a,y:l}=n??{x:0,y:0},h=[];switch(o){case 0:h.push({x:a,y:l});break;case 1:for(let u=Math.max(a-1,0);u<Math.min(a+2,e);u++)for(let m=Math.max(l-1,0);m<Math.min(l+2,t);m++)h.push({x:u,y:m});break;case 2:}return this.createRandomMineField(e,t,i,h,s)}static createMineFieldWithBoardNumber(e,t,i,n){let o=e*t,s=[],a=ae(n,o,i);for(let l=o-1;l>=0;l--,a>>=1n)a&1n&&s.push(l);return new r(e,t,s)}static createMineFieldWithMineMap(e,t,i){let n=[];for(let o=0;o<i.length;o++)i[o]&&n.push(o);return new r(e,t,n)}initBoard(e){let t=this.width,i=this.height;this.board.length=t*i,this.board.fill(0);let n=o=>{let s=typeof o=="number"?Math.trunc(o/t):o.y,a=typeof o=="number"?o-s*t:o.x;if(d(s>=0&&s<i&&a>=0&&a<t,"Mine position is outside the grid"),this.board[a+s*t]<0)throw new Error(`Same cell marked as mine more than once: {X: ${a}, y: ${s}}`);this.board[a+s*t]=-2;for(let l=Math.max(a-1,0);l<Math.min(a+2,t);l++)for(let h=Math.max(s-1,0);h<Math.min(s+2,i);h++)this.board[l+h*t]!==-2&&this.board[l+h*t]++};for(let o of e)n(o)}getBoardNumber(){if(this._boardNumber===void 0){let e=0n;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e<<=1n,this.board[i+t*this.width]<0&&(e|=1n);this._boardNumber=se(e,this.width*this.height)}return this._boardNumber}getCellValue(e,t){return this.board[e+t*this.width]}getValueMap(){return this.board}clearTransientState(){return this._boardNumber=void 0,this}toString(){let e=this.board;return e?Array.from({length:this.height}).map((t,i)=>Array.from({length:this.width}).map((n,o)=>e[o+i*this.width]).map(n=>n===-2?"X":String(n)).join("")).join(`\n`):"Uninitialized"}};var S=class{cells=[];listeners=[];cellListener;openMines=0;minesRemaining=0;cellsRemaining=0;boardStarted=0;boardEnded=0;started=!1;view;clockEventInterval=0;timerId;constructor(e){this.cellListener=this.getCellListener(),this.reset(e),this.view=e}getCellVisibleState(e,t){return this.cells[e+t*this.view.width]?.getVisibleState()??-1}getCellListener(){return(e,t)=>{switch(t.type){case 0:if(e.isMine()){let i=this.openMines===0;this.openMines++,i&&(this.stopClock(),this.fireEvent(4,t.attributes))}else this.cellsRemaining--,this.started||(this.started=!0,this.startClock(),this.fireEvent(3,t.attributes)),this.cellsRemaining||(this.stopClock(),this.fireEvent(6,t.attributes));break;case 2:e.isFlagged()?this.minesRemaining--:this.minesRemaining++,this.fireEvent(8,t.attributes);break;case 1:e.isMine()?(this.openMines--,this.openMines||(this.startClock(),this.fireEvent(5,t.attributes))):this.cellsRemaining++||(this.startClock(),this.fireEvent(7,t.attributes));break}}}expandZeroGroup(e){let t=new Set,i=new Set;function n(){for(let o of i)return i.delete(o),o;throw new Error("Empty")}for(let o of W(e))i.add(o);for(;i.size;){let o=n(),{x:s,y:a}=o.position;if(t.add(o),this.view.getCellValue(s,a)===0)for(let h of o.getNeighbors())t.has(h)||i.add(h)}return t}getCell(e,t){return typeof e=="number"?t===void 0?(d(e>=0&&e<this.cells.length,"Index out of bounds"),this.cells[e]):(d(e>=0&&e<this.view.width&&t>=0&&t<this.view.height,"position outside grid"),this.cells[e+t*this.view.width]):this.cells[he(e,this.view.width,this.view.height)]}getAllCells(){return this.cells}getVisibleStateMap(){return this.cells.map(e=>e.getVisibleState())}isExploded(){return this.openMines>0}isComplete(){return this.started&&this.cellsRemaining<=0}getMinesRemaining(){return this.minesRemaining}getCellsRemaining(){return this.cellsRemaining}getTimeElapsed(){return this.boardStarted===0?0:this.boardEnded===0?Date.now()-this.boardStarted:this.boardEnded-this.boardStarted}setTimeElapsed(e,t){this.boardStarted=(this.boardEnded||Date.now())-e,this.startClock(t)}setClockEventInterval(e,t){this.clockEventInterval=e,e>0?this.startClock(t):this.stopClock(t)}startClock(e){this.timerId===void 0&&this.started&&this.boardEnded===0&&this.clockEventInterval>0&&(this.boardStarted=Date.now(),this.fireEvent(10,e),this.timerId=setInterval(()=>{this.fireEvent(10,e)},this.clockEventInterval))}stopClock(e){this.boardStarted!==0&&this.boardEnded===0&&(this.boardEnded=Date.now(),this.fireEvent(10,e)),this.timerId!==void 0&&(clearInterval(this.timerId),this.timerId=void 0)}reset(e,t){this.view=e;for(let o of this.getAllCells())o.dispose(t);let{width:i,height:n}=e;this.cells.length=i*n;for(let o=0;o<i;o++)for(let s=0;s<n;s++)(this.cells[o+s*i]=new Z({x:o,y:s},this)).addListener(this.cellListener);this.initializeStats(),this.fireEvent(1,t)}getView(){return this.view}initializeStats(){this.openMines=0;let{width:e,height:t,mineCount:i}=this.getView();this.minesRemaining=i,this.cellsRemaining=e*t-i,this.boardStarted=0,this.boardEnded=0,this.stopClock(),this.started=!1}dispose(e){for(let t of this.cells)t.dispose();this.fireEvent(0,e),this.listeners.length=0,this.cells.length=0}openGroup(e,t){for(let i of W(e))i.isOpened()||i.openNoExpand();this.fireEvent(9,t)}addListener(e){this.listeners.push(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};var Z=class{constructor(e,t){this.position=e;this.board=t}flagged=!1;value;opened=!1;pressed=!1;wrong=!1;listeners=[];attributes=new Map;neighbors=[];getVisibleState(){return this.opened?this.peek():this.flagged?-3:-1}isFlagged(){return this.flagged}isMine(){return this.peek()===-2}isOpened(){return this.opened}isPressed(){return this.pressed}isWrong(){return this.wrong}openNoExpand(e){return this.opened||(this.flag(!1),this.opened=!0,this.fireEvent(0,e)),this.peek()}open(e){this.board.openGroup(this.board.expandZeroGroup([this]),e)}peek(){return this.value===void 0&&(this.value=this.board.getView().getCellValue(this.position.x,this.position.y)),this.value}close(e){this.opened&&(this.fireEvent(1,e),this.opened=!1)}chord(e){if(!this.isOpened()||this.isMine())return;let t=0,i=[];this.getNeighbors().forEach(n=>{n.isFlagged()?t++:n.isOpened()||i.push(n)}),t===this.peek()&&this.board.openGroup(this.board.expandZeroGroup(i),e)}flag(e=!0,t){!this.isOpened()&&e!==this.flagged&&(this.flagged=e,this.fireEvent(2,t))}setWrong(e=!0,t){this.wrong!==e&&(this.wrong=e,this.fireEvent(3,t))}press(e=!0,t){this.isOpened()||this.isFlagged()||this.pressed!==e&&(this.pressed=e,this.fireEvent(6,t))}pressChord(e=!0,t){!this.isOpened()||this.isMine()||this.getNeighbors().forEach(i=>i.press(e,t))}pressCellOrChord(e=!0,t){this.isOpened()?this.pressChord(e,t):this.press(e,t)}getNeighbors(){if(!this.neighbors.length){let{x:e,y:t}=this.position,{width:i,height:n}=this.board.getView();for(let o=Math.max(e-1,0);o<Math.min(e+2,i);o++)for(let s=Math.max(t-1,0);s<Math.min(t+2,n);s++)(o!==e||s!==t)&&this.neighbors.push(this.board.getCell(o,s))}return this.neighbors}addListener(e){this.listeners.push(e)}reset(e){this.flagged=!1,this.opened=!1,this.pressed=!1,this.wrong=!1,this.value=void 0,this.fireEvent(4,e)}dispose(e){this.fireEvent(5,e),this.listeners.length=0,this.attributes.clear()}setAttribute(e,t){this.attributes.set(e,t)}getAttribute(e){return this.attributes.get(e)}clearAttribute(e){this.attributes.delete(e)}fireEvent(e,t){for(let i of this.listeners)i(this,{type:e,attributes:t})}};function Q(r){let e=r;d(typeof r=="object"&&!!r&&typeof e.height=="number"&&typeof e.width=="number"&&Array.isArray(e.cellData),"Invalid Board Info: "+JSON.stringify(r))}var U=class r{static valueCoder=new B(4);static timeElapsedCoder=new B(7);encodeValue(e,t){let{height:i,width:n,elapsedTime:o}=e;i===16&&n===30?(t.encodeBit(.5,1),t.encodeBit(.5,1)):i===16&&n===16?(t.encodeBit(.5,1),t.encodeBit(.5,0)):i===9&&n===9?(t.encodeBit(.5,0),t.encodeBit(.5,1)):(t.encodeBit(.5,0),t.encodeBit(.5,0),r.valueCoder.encodeValue(i-1,t),r.valueCoder.encodeValue(v.encode(n,i,1),t)),o?(t.encodeBit(.5,1),r.timeElapsedCoder.encodeValue(Math.trunc(o/500),t)):t.encodeBit(.5,0)}decodeValue(e){let t=e.decodeBit(.5),i=e.decodeBit(.5),n,o;t===1&&i===1?(n=16,o=30):t==1&&i===0?(n=16,o=16):t===0&&i===1?(n=9,o=9):(n=r.valueCoder.decodeValue(e)+1,o=v.decode(r.valueCoder.decodeValue(e),n,1));let s=0;return e.decodeBit(.5)&&(s=r.timeElapsedCoder.decodeValue(e)*500),{width:o,height:n,elapsedTime:s}}},K=class{constructor(e,t){this.width=e;this.height=t;this.width===30&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=99):this.width===16&&this.height===16?(this.standardBoardSize=!0,this.expectedMineCount=40):this.width===9&&this.height===9?(this.standardBoardSize=!0,this.expectedMineCount=10):(this.standardBoardSize=!1,this.expectedMineCount=Math.round(this.width*this.height/5));let i=Math.max(32-Math.clz32(this.width*this.height/20),1);this.customCoder=new B(i)}standardBoardSize;expectedMineCount;customCoder;encodeValue(e,t){if(this.standardBoardSize)if(this.expectedMineCount===e){t.encodeBit(.5,1);return}else t.encodeBit(.5,0);this.customCoder.encodeValue(v.encode(e,this.expectedMineCount),t)}decodeValue(e){return this.standardBoardSize&&e.decodeBit(.5)?this.expectedMineCount:v.decode(this.customCoder.decodeValue(e),this.expectedMineCount)}},N=class{cellCount;mineCountCoder;constructor(e,t){this.cellCount=e*t,this.mineCountCoder=new K(e,t)}encodeValue(e,t){let i=0;for(let n=0;n<this.cellCount;n++)e.getBit(n)&&i++;this.mineCountCoder.encodeValue(i,t),new x(this.cellCount,this.cellCount-i).encode(e.toReader(),t)}decodeValue(e){let t=this.mineCountCoder.decodeValue(e),i=new x(this.cellCount,this.cellCount-t),n=new b;return i.decode(e,n.toWriter()),n}},j=class{constructor(e,t,i){this.width=e;this.height=t;this.mineField=i;this.cellCount=e*t,this.openCountCoder=new I(this.cellCount+1),this.flagCountCoder=new B(Math.max(32-Math.clz32(this.mineField.mineCount)-1,1)),this.openMineCountCoder=this.wrongFlagCountCoder=this.closedInOpenGroupCoder=new B(0)}cellCount;openCountCoder;openMineCountCoder;flagCountCoder;wrongFlagCountCoder;closedInOpenGroupCoder;encodeValue(e,t){this.openCountCoder.encodeValue(e.opened,t),this.openMineCountCoder.encodeValue(e.openMines+1,t),this.flagCountCoder.encodeValue(e.flags,t),this.wrongFlagCountCoder.encodeValue(e.wrongFlags+1,t),this.closedInOpenGroupCoder.encodeValue(e.closedInOpenGroup+1,t)}decodeValue(e){let t=this.openCountCoder.decodeValue(e),i=this.openMineCountCoder.decodeValue(e)-1,n=this.flagCountCoder.decodeValue(e),o=this.wrongFlagCountCoder.decodeValue(e)-1,s=this.closedInOpenGroupCoder.decodeValue(e)-1;return{cells:this.cellCount,mines:this.mineField.mineCount,opened:t,openMines:i,flags:n,wrongFlags:o,closedInOpenGroup:s}}},O=class{constructor(e,t,i){this.width=e;this.height=t;this.mineField=i;this.tallyCoder=new j(e,t,i)}tallyCoder;encodeValue(e,t){c("[OpenStateCoder.encodeValue] encoding: %o",e);let i=ye(this.width,this.height,this.mineField,e);if(i.opened===0&&i.flags===0){c("[OpenStateCoder.encodeValue] encoding closed board"),t.encodeBit(.5,0);return}else c("[OpenStateCoder.encodeValue] encoding tally: %o",i),t.encodeBit(.5,1),this.tallyCoder.encodeValue(i,t);let n=i.mines===0?1:i.cells===i.mines?0:i.flags/i.mines/(i.opened/(i.cells-i.mines)),o=new S(this.mineField),s=0;for(let a=0;a<this.height;a++)for(let l=0;l<this.width;l++,s++){let h=this.left(e,this.mineField,l,a),u=this.up(e,this.mineField,l,a),m=this.mineField.getCellValue(l,a)===-2,f=o.getCell(l,a).isOpened(),{pOpen:p,pFlag:M}=ue([h,u].filter(T=>!!T),m,f,i,n),w=e[s]??0;c("[OpenStateCoder.encodeValue] encoding cell: %o",()=>({cellState:w,left:h,up:u,x:l,y:a,isMine:m,isInOpenGroup:f,flagRatio:n,pOpen:p,pFlag:M})),Ee(w,p,M,t),w===1&&o.getCell(l,a).openNoExpand(),X(i,m,e[s],f,-1)}}decodeValue(e){let t=e.decodeBit(.5),i=[];if(!t){for(let a=this.width*this.height;a>0;a--)i.push(0);return i}let n=this.tallyCoder.decodeValue(e),o=n.mines===0?1:n.cells===n.mines?0:n.flags/n.mines/(n.opened/(n.cells-n.mines)),s=new S(this.mineField);for(let a=0;a<this.height;a++)for(let l=0;l<this.width;l++){let h=this.left(i,this.mineField,l,a),u=this.up(i,this.mineField,l,a),m=this.mineField.getCellValue(l,a)===-2,f=s.getCell(l,a).isOpened(),{pOpen:p,pFlag:M}=ue([h,u].filter(T=>!!T),m,f,n,o),w=Me(p,M,e);i.push(w),w===1&&s.getCell(l,a).openNoExpand(),X(n,m,w,f,-1)}return i}neighbor(e,t,i,n,o,s){let a=i+o,l=n+s;if(!(a<0||a>=this.width||l<0||l>=this.height))return{isMine:t.getCellValue(a,l)===-2,openState:e[l*this.width+a]}}left(e,t,i,n){return this.neighbor(e,t,i,n,-1,0)}up(e,t,i,n){return this.neighbor(e,t,i,n,0,-1)}},V=class r{static dimensionCoder=new U;encodeValue(e,t){let{width:i,height:n,elapsedTime:o}=e,{minemap:s,openState:a}=Se(e.cellData),l=E.createMineFieldWithMineMap(i,n,[...s].map(h=>!!h));r.dimensionCoder.encodeValue(e,t),new N(i,n).encodeValue(s,t),new O(i,n,l).encodeValue(a,t)}decodeValue(e){let{width:t,height:i,elapsedTime:n}=r.dimensionCoder.decodeValue(e),o=new N(t,i).decodeValue(e),s=E.createMineFieldWithMineMap(t,i,[...o].map(l=>!!l)),a=new O(t,i,s).decodeValue(e);return{width:t,height:i,elapsedTime:n,cellData:xe(o,a)}}};function Se(r){let e=new g,t=[];for(let i of r)e.write(i.isMine?1:0),t.push(i.openState??0);return{minemap:e.bitset,openState:t}}function xe(r,e){let t=[];for(let i=0;i<e.length;i++)t.push({isMine:!!r.getBit(i),openState:e[i]});return t}function Ee(r,e,t,i){let n=r===0;i.encodeBit(Math.max(1-e-t,0),n?0:1),n||i.encodeBit(e/(e+t),r===2?1:0)}function Me(r,e,t){return t.decodeBit(Math.max(1-r-e,0))?t.decodeBit(r/(r+e))?2:1:0}function ye(r,e,t,i){let n={flags:0,opened:0,wrongFlags:0,openMines:0,mines:0,cells:0,closedInOpenGroup:0},o=new S(t),s=0;for(let a=0;a<e;a++)for(let l=0;l<r;l++,s++){let h=t.getCellValue(l,a)===-2,u=o.getCell(s).isOpened();i[s]===1&&o.getCell(s).openNoExpand(),X(n,h,i[s],u,1)}return n}function X(r,e,t,i,n){let o=t===2,s=t===1;r.cells+=n,o?(r.flags+=n,i&&(r.closedInOpenGroup+=n)):s?r.opened+=n:i&&(r.closedInOpenGroup+=n),e?(r.mines+=n,s&&(r.openMines+=n)):o&&(r.wrongFlags+=n)}function ue(r,e,t,i,n){c("[pOpenState] %o",{neighbors:r,isMine:e,isInOpenGroup:t,tally:i,flagRatio:n});let o=i.opened-i.openMines,s=i.cells-i.mines,a=e?i.openMines/i.mines:o/s,l=e?(i.flags-i.wrongFlags)/i.mines:i.wrongFlags/s;if(a===1||l===1||a===0&&l===0)return{pOpen:a,pFlag:l};if(t)return{pOpen:(s-i.closedInOpenGroup)/s,pFlag:Math.min(i.wrongFlags,i.closedInOpenGroup/2)/s};{let h=r.length,u=0,m=0;for(let p of r)p?.openState&&u++,p.isMine&&!p?.openState&&m++;h-=m*Math.max(1-n,0);let f=h===0?.5:u/h;return c("[pOpenState] weighting neighbor %o",{neighborOpenWeight:f,pFlag:l,pOpen:a}),f<=.5?e?l=Math.pow(l,(.5-f)*4+1):a=Math.pow(a,(.5-f)*4+1):e?(l=1-Math.pow(1-l,(f-.5)*4+1),a=Math.min(a,(1-l)/2)):(a=1-Math.pow(1-a,(f-.5)*4+1),l=Math.min(l,(1-a)/2)),{pOpen:a,pFlag:l}}}var Nt=re([[{value:0,bitCount:3},{value:0,bitCount:1}],[{value:4,bitCount:3},{value:1,bitCount:3}],[{value:2,bitCount:3},{value:5,bitCount:3}],[{value:6,bitCount:3},{value:7,bitCount:5}],[{value:1,bitCount:3},{value:3,bitCount:3}],[{value:5,bitCount:3},{value:23,bitCount:5}],[{value:3,bitCount:3},{value:15,bitCount:5}],[{value:7,bitCount:3},{value:31,bitCount:5}]]);if(typeof window>"u"&&typeof onmessage<"u"){let r=new V;onmessage=e=>{c("Processing web worker event: %o",e);let t=e.data;switch(t.messageType){case"ENCODE":{let{boardInfo:i}=t;Q(i);let n=Y(ee(i,r).toReader());postMessage({messageType:"ENCODE",boardId:n});break}case"DECODE":{let{boardId:i}=t;d(typeof i=="string","Invalid board id: "+JSON.stringify(i));let n=new g;q(i,n);let o=te(n.bitset.toReader(),r);postMessage({messageType:"DECODE",boardInfo:o});break}case"STATS":{let{boardInfo:i}=t;Q(i),postMessage({messageType:"STATS",stats:{}});break}default:throw new Error("Unknown message type: "+t.messageType)}}}})();';var ne,re,se,oe,Se,A;function xe(r){r.onload=function(){A=new P,ne=r.document.getElementById("width"),re=r.document.getElementById("height"),se=r.document.getElementById("mine_count");let e=r.document.getElementById("sidebar");oe=Array.from(e.querySelectorAll("[name=initial_click]")).filter(c=>c instanceof HTMLInputElement),Se=r.document.getElementById("minefield");let t=r.document.getElementById("reset"),i=r.document.getElementById("header");function n(c,w=!1){let m=new URL(location.href);c?m.searchParams.set("board_id",c):m.searchParams.delete("board_id"),w?r.history.replaceState({},"",m):r.history.pushState({},"",m)}r.addEventListener("popstate",c=>{let m=new URL(location.href).searchParams.get("board_id");m?A.requestDecode(m):o.getAllCells().forEach(p=>{p.close(),p.flag(!1)})});function s(c){!c?.DECODING&&!c?.EXPOSING&&A.requestEncode(o)}A.addEncodeListener({handleEncodeResponse:c=>{n(c)}});let o=new y(new C(1,1,[]));r.board=o,A.addDecodeToBoardListener(o);let a=void 0;o.setClockEventInterval(200);let d=new G([1,2,3].map(c=>r.document.getElementById("mines_remaining_"+c)));function h(){d.setValue(o.getMinesRemaining())}let u=new G([1,2,3].map(c=>r.document.getElementById("timer_"+c)));function g(){u.setValue(o.getTimeElapsed()/1e3)}function b(c,w){switch(w.type){case 8:h(),s(w.attributes);break;case 6:setTimeout(()=>{for(let m of o.getAllCells())m.isOpened()||m.flag(!0,{EXPOSING:!0});t.innerText="\u{1F60E}"},0);break;case 7:t.innerText="\u{1F914}";break;case 4:setTimeout(()=>{let m=new Set;for(let p of o.getAllCells()){let ae=p.peek()===-2;ae&&!p.isFlagged()?p.isOpened()?p.setWrong(!0,{EXPOSING:!0}):m.add(p):p.isFlagged()&&!ae&&p.setWrong(!0,{EXPOSING:!0})}o.openGroup(m,{EXPOSING:!0}),t.innerText="\u{1F635}"},0);break;case 5:t.innerText="\u{1F914}",o.getAllCells().forEach(m=>m.setWrong(!1));break;case 10:g();break;case 1:t.innerText="\u{1F600}",h(),g(),ze(Se,o,a),ne.value=String(o.getView().width),re.value=String(o.getView().height),se.value=String(o.getView().mineCount),oe.filter(m=>m.value===T[Me().openingConfig]).forEach(m=>m.checked=!0),w.attributes?.DECODING||n("");break;case 3:t.innerText="\u{1F914}";break;case 9:s(w.attributes);break}}o.addListener(b);function B(){try{let{width:c,height:w,mines:m,openingConfig:p}=Me();o.reset(new k(c,w,m,p))}catch(c){ye(c)}}e.addEventListener("change",B);let S=c=>{try{if(c.button!==0)return;let{width:w,height:m,mineCount:p}=o.getView();switch(c.type){case"mousedown":t.classList.add("pressed");break;case"mouseup":t.classList.remove("pressed"),B();break;case"mouseenter":c.buttons===1&&t.classList.add("pressed");break;case"mouseleave":c.buttons===1&&t.classList.remove("pressed");break}}catch(w){ye(w)}};i.addEventListener("mousedown",S),i.addEventListener("mouseup",S),i.addEventListener("mouseenter",S),i.addEventListener("mouseleave",S);let R=new URL(location.href).searchParams.get("board_id");R?A.requestDecode(R):B()}}function ze(r,e,t){r.innerHTML="";let{width:i,height:n}=e.getView(),s=[],o=Ue(e),a=Ze(e,t);for(let d=0;d<n;d++)for(let h=0;h<i;h++){let u=document.createElement("div");u.classList.add("cell"),u.classList.add("closed"),u.style.setProperty("grid-row",String(d+1)),u.setAttribute("x",String(h)),u.setAttribute("y",String(d));let g=e.getCell(h,d);g.setAttribute("element",u),g.addListener(o),u.addEventListener("mousedown",a),u.addEventListener("mouseup",a),u.addEventListener("mouseenter",a),u.addEventListener("mouseleave",a),r.appendChild(u)}return s.join(`
`)}function Ue(r){return(e,t)=>{let i=e.getAttribute("element");if(i)switch(t.type){case 0:i.classList.remove("closed"),i.classList.add("open"),i.classList.remove("pressed"),e.peek()<0?i.classList.add("mine"):e.peek()>0&&(r.isExploded()||i.classList.add("n"+e.peek()));break;case 1:i.classList.remove("open"),i.classList.add("closed"),i.classList.remove("pressed"),i.classList.remove("mine"),i.classList.remove("wrong"),i.classList.remove("n1"),i.classList.remove("n2"),i.classList.remove("n3"),i.classList.remove("n4"),i.classList.remove("n5"),i.classList.remove("n6"),i.classList.remove("n7"),i.classList.remove("n8");break;case 4:for(let n of Array.from(i.classList))n!=="cell"&&i.classList.remove(n),i.classList.add("closed");break;case 2:e.isFlagged()?i.classList.add("flagged"):i.classList.remove("flagged");break;case 3:e.isWrong()?i.classList.add("wrong"):i.classList.remove("wrong");break;case 6:e.isPressed()?i.classList.add("pressed"):i.classList.remove("pressed")}}}function Ze(r,e){return t=>{let i=Ie(t.target);if(!i)return;let n=r.getCell(i.x,i.y);n&&(t.preventDefault(),!(r.isExploded()||r.isComplete())&&(t.button===2&&t.type==="mousedown"&&(n.isOpened()?n.chord():n.flag(!n.isFlagged())),t.button===0&&t.type==="mouseup"&&(!n.isFlagged()&&!n.isOpened()?n.open():n.isOpened()&&n.chord()),(t.button===0&&t.type==="mousedown"||t.buttons===1&&t.type==="mouseenter")&&n.pressCellOrChord(),(t.button===0&&t.type==="mouseup"||t.buttons===1&&t.type==="mouseleave")&&n.pressCellOrChord(!1)))}}function Ie(r){if(r instanceof HTMLElement){let e=r.getAttribute("x"),t=r.getAttribute("y");return e&&t&&/^[0-9]+$/.test(e)&&/^[0-9]+$/.test(t)?{x:parseInt(e),y:parseInt(t)}:Ie(r.parentElement)}return null}var G=class{constructor(e){this.cells=e}setValue(e){function t(i,n,s){return new Array(Math.max(n-i.length,0)).fill(s).join("")+i}if(typeof e=="number"){e=Math.trunc(e);let i="";e<0&&(i="-",e=-e),e>=10**(this.cells.length-i.length)?e=i+t("",this.cells.length-i.length,"9"):e=t(i+e.toString(),this.cells.length,"0")}else e.length<this.cells.length?e=t(e,this.cells.length," "):e=e.substring(0,this.cells.length);for(let i=0;i<this.cells.length;i++)this.cells[i].innerText=e[i]}};function Me(){let r=ne.valueAsNumber,e=re.valueAsNumber,t=se.valueAsNumber,i=oe.find(o=>o.checked)?.value,n=T[i]??2;(isNaN(r)||r<1)&&(r=1),(isNaN(e)||e<1)&&(e=1);let s=r*e;return isNaN(t)||t<1?t=0:t>s&&(t=s),t===s?n=2:t>s-9&&n===1&&(n=2),{width:r,height:e,mines:t,openingConfig:n}}function ye(r){console.log(r)}var Re=typeof window>"u"?void 0:window;Re&&xe(Re);})();
