import{a as E,b as x,c as R,d as N,e as u,f as M,g as y,i as _,j as f,k as F,l as O}from"./chunk-PM5BLPZR.js";var b=class{worker;encodeListeners=new Set;decodeListeners=new Set;boardListeners=new Map;terminated=!1;lastEncoded;constructor(){M("[BoardIdWorker] Starting Board ID worker"),this.worker=new Worker("./board_id_worker_entry.js",{type:"module",name:"BoardIdWorker"}),this.worker.onerror=e=>{y(`[BoardIdWorker.worker.onerror] Got error. Message: %o
Error: %o
filename: % o
lineno: % o
event: % o`,e.message,e.error,e.filename,e.lineno,e)},this.worker.onmessageerror=e=>{y("[BoardIdWorker.worker.onerror] Got error. Data: %oevent: %o",e.data,e)},this.worker.onmessage=e=>{u("[BoardIdWorker.worker.onmessage] Message to worker received: %o",e);let n=e.data;switch(n.messageType){case"DECODE":let{boardState:t}=n;F(t),this.decodeListeners.forEach(s=>s.handleDecodeResponse(t));break;case"ENCODE":let{encodedBoardState:i}=n;O(i),this.encodeListeners.forEach(s=>s.handleEncodeResponse(i));break;default:throw new Error("Unrecognized message response type: "+JSON.stringify(n))}},M("[BoardIdWorker] Board ID worker initialized")}requestEncode(e){E(!this.terminated,"BoardIdWorker has been terminated");let n=e.getView();if(this.lastEncoded?.view===n)for(let i of this.encodeListeners)i.handleEncodeResponse;let t=te(e);u("[BoardIdWorker.requestEncode] Sending encode request: %o",t),this.worker.postMessage({messageType:"ENCODE",boardState:t})}requestDecode(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.requestDecode] Sending decode request: %o",e),this.worker.postMessage({messageType:"DECODE",encodedBoardState:e})}addEncodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addEncodeListener]"),this.encodeListeners.add(e)}removeEncodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.removeEncodeListener]"),this.encodeListeners.delete(e)}addDecodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addDecodeListener]"),this.decodeListeners.add(e)}removeDecodeListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.removeDecodeListener]"),this.decodeListeners.delete(e)}addDecodeToBoardListener(e){E(!this.terminated,"BoardIdWorker has been terminated"),u("[BoardIdWorker.addDecodeToBoardListener]");let n={handleDecodeResponse:t=>{f(e,t,{DECODING:!0})}};this.removeDecodeToBoardListener(e),this.boardListeners.set(e,n),this.addDecodeListener(n)}removeDecodeToBoardListener(e){let n=this.boardListeners.get(e);n&&(this.removeDecodeListener(n),this.boardListeners.delete(e))}terminate(){this.terminated=!0,this.encodeListeners.clear(),this.decodeListeners.clear(),this.boardListeners.clear(),this.worker.terminate()}};function te(r){let e=r.getTimeElapsed(),n=r.getView(),{width:t,height:i}=n,s=r.getAllCells().map(l=>({isMine:n.getCellValue(l.position.x,l.position.y)===-2,openState:l.isOpened()?1:l.isFlagged()?2:0}));return{width:t,height:i,elapsedTime:e,cellData:s}}function G(r){let e,n=new URL(r.location.href),t=n.searchParams.get("board_id");if(t){let i=n.searchParams.get("view_state")??void 0,s=n.searchParams.get("elapsed_time")??void 0;e=new L(r,t,i,s)}else e=new L(r);r.minesweeper=e}var L=class{constructor(e,n,t,i){this.win=e;this.board=new N(new R(1,1,[])),this.board.setClockEventInterval(200),this.board.addListener((c,v)=>this.handleBoardEvent(v)),this.boardIdWorker=this.initBoardIdWorker();let s=se(e);this.bodyElement=s.bodyElement,this.widthElement=s.widthElement,this.heightElement=s.heightElement,this.mineCountElement=s.mineCountElement,this.expertPreset=s.expertPreset,this.intermediatePreset=s.intermediatePreset,this.beginnerPreset=s.beginnerPreset,this.systemColor=s.systemColor,this.lightColor=s.lightColor,this.darkColor=s.darkColor,this.noMineElement=s.noMineElement,this.openAreaElement=s.openAreaElement,this.minePossibleElement=s.minePossibleElement,this.allowUndoElement=s.allowUndoElement,this.singleClickChordElement=s.singleClickChordElement,this.allowFlagChordElement=s.allowFlagChordElement,this.mineFieldBoard=s.mineFieldBoard,this.minefieldBoardWrapper=s.minefieldBoardWrapper,this.resetButton=s.resetButton,this.resetHeader=s.resetHeader,this.minesRemainingDisplay=new w(s.minesRemainingElements),this.timerDisplay=new w(s.timerElements),this.debugElement=s.debugElement;let l=c=>this.handleConfigChangeEvent(c);for(let c of[this.widthElement,this.heightElement,this.mineCountElement,this.noMineElement,this.openAreaElement,this.minePossibleElement])c.addEventListener("change",l);let o=c=>this.handlePresetClickEvent(c);this.expertPreset.addEventListener("click",o),this.intermediatePreset.addEventListener("click",o),this.beginnerPreset.addEventListener("click",o);let d=c=>this.handleColorPaletteEvent(c);this.systemColor.addEventListener("change",d),this.lightColor.addEventListener("change",d),this.darkColor.addEventListener("change",d);let a=c=>this.handlePlayStyleChange(c);this.allowUndoElement.addEventListener("change",a),this.singleClickChordElement.addEventListener("change",a),this.allowFlagChordElement.addEventListener("change",a),this.resetButton.addEventListener("click",()=>this.rebuildMineField());let h=c=>this.handleResetMouseEvent(c),m=c=>this.handleResetTouchEvent(c);this.resetHeader.addEventListener("mousedown",h),this.resetHeader.addEventListener("mouseup",h),this.resetHeader.addEventListener("mouseout",h),this.resetHeader.addEventListener("mouseover",h),this.resetHeader.addEventListener("touchend",m);let p=JSON.parse(e.localStorage?.getItem("settings")??"null");this.setSettings(p),s.boardConfigMenu.ensureState(),s.settingsMenu.ensureState(),this.rebuildMineField(n,t,i)}board;boardIdWorker;bodyElement;widthElement;heightElement;mineCountElement;expertPreset;intermediatePreset;beginnerPreset;systemColor;lightColor;darkColor;noMineElement;openAreaElement;minePossibleElement;allowUndoElement;singleClickChordElement;allowFlagChordElement;mineFieldBoard;minefieldBoardWrapper;resetButton;resetHeader;minesRemainingDisplay;timerDisplay;debugElement;resetMouseDownButtons=0;cellMouseDownButtons=0;cellMouseReleasedButtons=0;cellTouchStart;previousActiveCell;handleBoardEvent(e){switch(e.type){case 8:this.updateMinesRemaining(),this.requestBoardEncode(e.attributes);break;case 6:setTimeout(()=>{for(let n of this.board.getAllCells())n.isOpened()||n.flag(!0,{EXPOSING:!0});this.bodyElement.classList.add("complete")},0);break;case 7:this.bodyElement.classList.remove("complete");break;case 4:setTimeout(()=>{let n=new Set;for(let t of this.board.getAllCells()){let i=t.peek()===-2;i&&!t.isFlagged()?t.isOpened()?t.setWrong(!0,{EXPOSING:!0}):n.add(t):t.isFlagged()&&!i&&t.setWrong(!0,{EXPOSING:!0})}this.board.openGroup(n,{EXPOSING:!0}),this.bodyElement.classList.add("explode")},0);break;case 5:this.bodyElement.classList.remove("explode"),this.board.getAllCells().forEach(n=>n.setWrong(!1));break;case 10:this.updateTimer();break;case 1:this.updateMinesRemaining(),this.updateTimer(),this.resetBoard(),this.widthElement.value=String(this.board.getView().width),this.heightElement.value=String(this.board.getView().height),this.mineCountElement.value=String(this.board.getView().mineCount),e.attributes?.DECODING||(this.bodyElement.classList.remove("in_progress"),this.bodyElement.classList.remove("explode"),this.bodyElement.classList.remove("complete"),this.updateBoardId()),this.minefieldBoardWrapper.classList.remove("blank");break;case 3:this.bodyElement.classList.add("in_progress");break;case 9:this.requestBoardEncode(e.attributes);break}}handleCellEvent(e,n){let t=g(e);if(t)switch(n.type){case 0:t.classList.remove("closed"),t.classList.add("open"),t.classList.remove("pressed"),e.peek()<0?(t.textContent="*",t.classList.add("mine")):this.board.isExploded()||(t.textContent=e.peek().toString(),t.classList.add("n"+e.peek()));break;case 1:t.classList.remove("open"),t.classList.add("closed"),t.classList.remove("pressed"),t.classList.remove("mine"),t.classList.remove("wrong"),t.classList.remove("n1"),t.classList.remove("n2"),t.classList.remove("n3"),t.classList.remove("n4"),t.classList.remove("n5"),t.classList.remove("n6"),t.classList.remove("n7"),t.classList.remove("n8"),t.textContent="";break;case 4:for(let i of Array.from(t.classList))i!=="cell"&&t.classList.remove(i),t.classList.add("closed");break;case 2:e.isFlagged()?(t.classList.add("flagged"),e.isOpened()||(t.textContent="`")):(t.classList.remove("flagged"),e.isOpened()||(t.textContent=""));break;case 3:e.isWrong()?t.classList.add("wrong"):t.classList.remove("wrong");break;case 6:e.isPressed()?t.classList.add("pressed"):t.classList.remove("pressed")}}handleCellMouseEvent(e){let n=this.getCellForUiEvent(e);if(n){switch(e.type){case"mousedown":this.cellMouseDownButtons|=e.buttons,this.cellMouseReleasedButtons=0,e.buttons&1||e.buttons&4?n.pressCellOrChord(!0,this.singleClickChordElement.checked||!!(e.buttons&6),!!(e.buttons&1)):e.buttons&2&&this.processFlag(n);return;case"mouseup":let t=this.cellMouseDownButtons&~e.buttons;this.cellMouseDownButtons&=e.buttons,this.cellMouseReleasedButtons|=t,n.pressCellOrChord(!1),this.cellMouseReleasedButtons&1?this.processClick(n,this.singleClickChordElement.checked||!!(this.cellMouseReleasedButtons&6)):this.cellMouseReleasedButtons&4&&this.processClick(n,!0,!1);break;case"mouseenter":this.cellMouseDownButtons&=e.buttons,this.cellMouseReleasedButtons=0,this.cellMouseDownButtons&1&&n.pressCellOrChord();break;case"mouseleave":this.cellMouseReleasedButtons=0,n.pressCellOrChord(!1);break}e.preventDefault()}}handleCellTouchEvent(e){let n=this.getCellForUiEvent(e);if(!n)return;let t=e.touches.length?e.touches:e.changedTouches;if(t.length!==1){this.cellTouchStart=void 0;return}let i=t[0];switch(this.cellTouchStart&&i.identifier!==this.cellTouchStart.identifier&&(this.cellTouchStart=void 0),e.type){case"touchstart":let{identifier:s,screenX:l,screenY:o}=i;this.cellTouchStart={identifier:s,screenX:l,screenY:o};return;case"touchend":if(!this.cellTouchStart)return;let d=g(n),{width:a,height:h}=d?.getBoundingClientRect?.()??{width:0,height:0},m=this.win.visualViewport?.scale??1,p=Math.abs(i.screenX-(this.cellTouchStart?.screenX??0)),c=Math.abs(i.screenY-(this.cellTouchStart?.screenY??0));console.log("Got touch: %o",{touch:i,scale:m,touchStart:this.cellTouchStart}),p<=a*m&&c<=h*m&&(e.cancelable&&e.preventDefault(),this.processClick(n));break;default:return}}handleCellKeyEvent(e){let n=this.getCellForUiEvent(e);if(!n)return;let{x:t,y:i}=n.position,{width:s,height:l}=this.board.getView(),o=!1;switch(e.key){case"ArrowUp":i--,o=!0;break;case"ArrowDown":i++,o=!0;break;case"ArrowLeft":t--,o=!0;break;case"ArrowRight":t++,o=!0;break;case"Enter":case" ":this.processClick(n,this.singleClickChordElement.checked);break;case"f":this.processFlag(n);break;case"Escape":this.resetButton.focus();break;default:return}if(e.preventDefault(),o){let d=this.board.getCell((t+s)%s,(i+l)%l),a=g(d);this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=a,a.tabIndex=0,a.focus()}}handleConfigChangeEvent(e){if(!e.defaultPrevented&&!this.board.isStarted()){switch(this.highlightActivePreset(),this.saveState(),e.target){case this.widthElement:case this.heightElement:case this.mineCountElement:case this.noMineElement:case this.openAreaElement:case this.minePossibleElement:this.rebuildMineField();break}e.preventDefault()}}handlePresetClickEvent(e){if(!e.defaultPrevented){switch(e.target){case this.expertPreset:this.updateMenuDimensions(30,16,99)&&this.widthElement.dispatchEvent(new Event("change"));break;case this.intermediatePreset:this.updateMenuDimensions(16,16,40)&&this.widthElement.dispatchEvent(new Event("change"));break;case this.beginnerPreset:this.updateMenuDimensions(9,9,10)&&this.widthElement.dispatchEvent(new Event("change"));break;default:return}e.preventDefault()}}handleColorPaletteEvent(e){e.defaultPrevented||(this.setColorPalette(e.target.value),this.saveState(),e.preventDefault())}setColorPalette(e){switch(e){case"SYSTEM":this.bodyElement.classList.remove("light"),this.bodyElement.classList.remove("dark"),this.systemColor.checked=!0;break;case"LIGHT":this.bodyElement.classList.add("light"),this.bodyElement.classList.remove("dark"),this.lightColor.checked=!0;break;case"DARK":this.bodyElement.classList.remove("light"),this.bodyElement.classList.add("dark"),this.darkColor.checked=!0;break;default:return}}handlePlayStyleChange(e){e.defaultPrevented||(this.saveState(),e.preventDefault())}handleResetMouseEvent(e){if(!e.defaultPrevented&&e.target===this.resetHeader&&!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)){switch(e.type){case"mousedown":this.resetMouseDownButtons=e.buttons,this.resetMouseDownButtons&1&&this.resetButton.classList.add("pressed");return;case"mouseup":let n=this.resetMouseDownButtons&~e.buttons;this.resetMouseDownButtons&=e.buttons,n&1&&(this.resetButton.classList.add("pressed"),setTimeout(()=>{this.resetButton.classList.remove("pressed"),this.resetButton.click()},0));break;case"mouseover":this.resetMouseDownButtons&=e.buttons,this.resetMouseDownButtons&1&&this.resetButton.classList.add("pressed");break;case"mouseout":this.resetButton.classList.remove("pressed");break}e.preventDefault()}}handleResetTouchEvent(e){if(!(e.defaultPrevented||e.target!==this.resetHeader||e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.touches.length?e.touches:e.changedTouches).length!==1))switch(e.type){case"touchend":e.cancelable&&(this.resetButton.classList.add("pressed"),setTimeout(()=>{this.resetButton.classList.remove("pressed"),this.resetButton.click()},0),e.preventDefault())}}resetBoard(){this.mineFieldBoard.innerHTML="";let{width:e,height:n}=this.board.getView(),t=(o,d)=>this.handleCellEvent(o,d),i=o=>this.handleCellMouseEvent(o),s=o=>this.handleCellTouchEvent(o),l=o=>this.handleCellKeyEvent(o);for(let o=0;o<n;o++)for(let d=0;d<e;d++){let a=document.createElement("button");a.tabIndex=-1,a.classList.add("cell"),a.classList.add("closed"),a.style.setProperty("grid-row",String(o+1)),a.setAttribute("x",String(d)),a.setAttribute("y",String(o));let h=this.board.getCell(d,o);h.setAttribute("element",a),h.addListener(t),a.addEventListener("mousedown",i),a.addEventListener("mouseup",i),a.addEventListener("mouseenter",i),a.addEventListener("mouseleave",i),a.addEventListener("touchstart",s),a.addEventListener("touchend",s),a.addEventListener("keydown",l),this.mineFieldBoard.appendChild(a)}this.previousActiveCell=this.mineFieldBoard.firstElementChild,this.previousActiveCell.tabIndex=0}updateBoardId(e){let n=new URL(location.href),t=n.search;e?.boardId?(n.searchParams.set("board_id",e?.boardId),e?.viewState?n.searchParams.set("view_state",e?.viewState):n.searchParams.delete("view_state"),e?.elapsedTime?n.searchParams.set("elapsed_time",e?.elapsedTime):n.searchParams.delete("elapsed_time")):(n.searchParams.delete("board_id"),n.searchParams.delete("view_state"),n.searchParams.delete("elapsed_time")),t!==n.search&&(this.allowUndoElement.checked||(t?.length??0)<=1?this.win.history.pushState({},"",n):this.win.history.replaceState({},"",n))}rebuildMineField(e,n,t){if(e){let i;typeof e=="string"?i=_({boardId:e,viewState:n,elapsedTime:t}):i=e,f(this.board,i,{DECODING:!0})}else{let{width:i,height:s,mines:l,initialClick:o}=this.getBoardConfig();this.board.reset(new x(i,s,l,o))}}getBoardConfig(){let{width:e,height:n,mineCount:t,initialClick:i}=this.getSettings();(!e||isNaN(e)||e<1)&&(e=1),(!n||isNaN(n)||n<1)&&(n=1);let s=e*n;return!t||isNaN(t)||t<1?t=0:t>s&&(t=s),t===s?i=2:t>s-9&&i===1&&(i=2),{width:e,height:n,mines:t,initialClick:i}}updateMenuDimensions(e,n,t){let i=!1;return this.widthElement.valueAsNumber!==e&&(i=!0,this.widthElement.valueAsNumber=e),this.heightElement.valueAsNumber!==n&&(i=!0,this.heightElement.valueAsNumber=n),this.mineCountElement.valueAsNumber!==t&&(i=!0,this.mineCountElement.valueAsNumber=t),this.highlightActivePreset(),i}highlightActivePreset(){let{width:e,height:n,mines:t}=this.getBoardConfig(),i;n===16&&e===30&&t===99?i=this.expertPreset:n===16&&e===16&&t===40?i=this.intermediatePreset:n===9&&e===9&&t===10&&(i=this.beginnerPreset),[this.expertPreset,this.intermediatePreset,this.beginnerPreset].forEach(s=>{s.classList.toggle("active",i===s)})}getSettings(){let e=this.darkColor.checked?"DARK":this.lightColor.checked?"LIGHT":"SYSTEM",n=this.widthElement.valueAsNumber,t=this.heightElement.valueAsNumber,i=this.mineCountElement.valueAsNumber,s=this.openAreaElement.checked?1:this.minePossibleElement.checked?2:0,l=this.allowUndoElement.checked,o=this.singleClickChordElement.checked,d=this.allowFlagChordElement.checked;return{colorPalette:e,width:n,height:t,mineCount:i,initialClick:s,allowUndo:l,singleClickChord:o,allowFlagChord:d}}setSettings(e){switch(this.setColorPalette(e?.colorPalette??"SYSTEM"),e?.initialClick){case 1:this.openAreaElement.checked=!0;break;case 2:this.minePossibleElement.checked=!0;break;default:this.noMineElement.checked=!0;break}this.updateMenuDimensions(e?.width??30,e?.height??16,e?.mineCount??99),this.allowUndoElement.checked=e?.allowUndo??!1,this.singleClickChordElement.checked=e?.singleClickChord??!1,this.allowFlagChordElement.checked=e?.allowFlagChord??!1}saveState(){let e=JSON.stringify(this.getSettings());this.win.localStorage&&this.win.localStorage.setItem("settings",e)}getCellForUiEvent(e){if(e.defaultPrevented||this.board.isExploded()||this.board.isComplete()||e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)return;let n=U(e.target),{x:t,y:i}=n??{x:0,y:0};return this.board.getCell(t,i)}handleEncodeResponse(e){this.updateBoardId(e)}requestBoardEncode(e){!e?.DECODING&&!e?.EXPOSING&&this.boardIdWorker.requestEncode(this.board)}updateMinesRemaining(){this.minesRemainingDisplay.setValue(this.board.getMinesRemaining())}updateTimer(){this.timerDisplay.setValue(this.board.getTimeElapsed()/1e3)}processClick(e,n=!1,t=!0){this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=g(e),this.previousActiveCell.tabIndex=0,e.isOpened()&&n?e.chord():!e.isFlagged()&&t&&e.open()}processFlag(e){this.previousActiveCell&&(this.previousActiveCell.tabIndex=-1),this.previousActiveCell=g(e),this.previousActiveCell.tabIndex=0,e.isOpened()&&this.allowFlagChordElement.checked?e.chord():e.flag(!e.isFlagged())}initBoardIdWorker(){let e=new b;return this.win.addEventListener("popstate",()=>{let n=new URL(location.href),t=n.searchParams.get("board_id"),i=n.searchParams.get("view_state")??void 0,s=n.searchParams.get("elapsed_time")??void 0;t?e.requestDecode({boardId:t,viewState:i,elapsedTime:s}):this.allowUndoElement.checked?this.board.getAllCells().forEach(l=>{l.close(),l.flag(!1)}):this.rebuildMineField()}),e.addDecodeToBoardListener(this.board),e.addEncodeListener(this),e}logError(e){console.log(e),this.debugElement.innerHTML+=JSON.stringify(e)+`
`}};function k(r){r.classList.remove("active")}function W(r){r.classList.add("active"),document.activeElement===r.querySelector(".menu_pulldown")&&r.querySelector('[tabindex="0"]')?.focus()}function K(r){return r.classList.contains("active")}function U(r){if(r instanceof HTMLElement){let e=r.getAttribute("x"),n=r.getAttribute("y");return e&&n&&/^[0-9]+$/.test(e)&&/^[0-9]+$/.test(n)?{x:parseInt(e),y:parseInt(n)}:U(r.parentElement)}return null}function g(r){return r.getAttribute("element")}var w=class{constructor(e){this.cells=e}setValue(e){function n(t,i,s){return new Array(Math.max(i-t.length,0)).fill(s).join("")+t}if(typeof e=="number"){e=Math.trunc(e);let t="";e<0&&(t="-",e=-e),e>=10**(this.cells.length-t.length)?e=t+n("",this.cells.length-t.length,"9"):e=n(t+e.toString(),this.cells.length,"0")}else e.length<this.cells.length?e=n(e,this.cells.length," "):e=e.substring(0,this.cells.length);for(let t=0;t<this.cells.length;t++)this.cells[t].innerText=e[t]}};function q(r){return r.classList.contains("active")||r.checked}function ne(r){return r.findIndex(q)}var C=class{constructor(e,n,t){this.menu=e;this.menuButton=n;this.menuGroups=t;this.menu.addEventListener("keydown",s=>this.handleKeyEvent(s)),this.menu.addEventListener("focusin",s=>this.handleFocusEvent(s)),this.menu.addEventListener("focusout",s=>this.handleFocusEvent(s)),this.menuButton.addEventListener("pointerdown",s=>this.handleToggleEvent(s));let i=this.menu.getRootNode();i.addEventListener("pointerdown",s=>this.handleCloseEvent(s)),i.addEventListener("keydown",s=>this.handleCloseEvent(s)),i.addEventListener("focusin",s=>this.handleCloseEvent(s))}getGroupIndex(e){return this.menuGroups.map((n,t)=>[t,n.indexOf(e)]).find(n=>n[1]>=0)}handleKeyEvent(e){if(e.defaultPrevented||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;let n=e.target,t=this.getGroupIndex(n),i=this.menuGroups[t[0]],s=(l,o)=>{let d=this.menuGroups[((t?.[0]??-1)+o+this.menuGroups.length)%this.menuGroups.length],a=o===0?t[1]:ne(d);d[(a+l+d.length)%d.length].focus(),this.ensureState()};switch(e.code){case"Escape":k(this.menu);break;case"ArrowDown":s(0,1);break;case"ArrowUp":s(0,-1);break;case"ArrowLeft":if(i.length>1)s(-1,0);else return;break;case"ArrowRight":if(i.length>1)s(1,0);else return;break;default:return}e.preventDefault()}handleFocusEvent(e){if(!e.defaultPrevented)switch(e.type){case"focusin":W(this.menu),this.ensureState();break;case"focusout":this.ensureState();break}}ensureState(){if(this.menu.contains(document.activeElement)&&document.activeElement!==this.menuButton){this.menuGroups.flatMap(t=>t).forEach(t=>t.tabIndex=-1),document.activeElement.tabIndex=0;return}let e,n;for(let t of this.menuGroups)for(let i of t)i.tabIndex===0&&(e?(console.warn("found multiple tabbable elements. Using first"),i.tabIndex=-1):(e=t,n=i));if((!e||!n)&&(e=this.menuGroups[0],n=e[0],n.tabIndex=0),document.activeElement===this.menuButton)n.focus();else if(e.length>1){let t=e.find(q);t?t!==n&&(n.tabIndex=-1,t.tabIndex=0):n.type==="radio"&&(n.checked=!0)}}handleCloseEvent(e){e.defaultPrevented||!this.menu.contains(e.target)&&e.target!==this.menuButton&&K(this.menu)&&k(this.menu)}handleToggleEvent(e){e.defaultPrevented||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(K(this.menu)?k(this.menu):W(this.menu),e.cancelable&&e.preventDefault())}};function se(r){let e=r.document.getElementsByTagName("body")[0],n=r.document.getElementById("board_menu"),t=r.document.getElementById("board_menu_pulldown"),i=r.document.getElementById("settings_menu"),s=r.document.getElementById("settings_menu_pulldown"),l=r.document.getElementById("width"),o=r.document.getElementById("height"),d=r.document.getElementById("mines"),a=window.document.getElementById("expert_preset"),h=window.document.getElementById("intermediate_preset"),m=window.document.getElementById("beginner_preset"),p=window.document.getElementById("system_color"),c=window.document.getElementById("light_color"),v=window.document.getElementById("dark_color"),T=window.document.getElementById("no_mine"),S=window.document.getElementById("open_area"),D=window.document.getElementById("mine_possible"),P=window.document.getElementById("allow_undo"),H=window.document.getElementById("single_click_chord"),A=window.document.getElementById("allow_flag_chord"),V=r.document.getElementById("minefield"),Y=r.document.getElementById("minefield_board"),X=r.document.getElementById("reset"),J=r.document.getElementById("header"),z=[1,2,3].map(B=>r.document.getElementById("mines_remaining_"+B)),Z=[1,2,3].map(B=>r.document.getElementById("timer_"+B)),j=r.document.getElementById("debug_element"),$=new C(n,t,[[a,h,m],[l],[o],[d]]),Q=new C(i,s,[[p,c,v],[T,S,D],[P],[H],[A]]);return{bodyElement:e,boardConfigMenu:$,settingsMenu:Q,widthElement:l,heightElement:o,mineCountElement:d,expertPreset:a,intermediatePreset:h,beginnerPreset:m,systemColor:p,lightColor:c,darkColor:v,noMineElement:T,openAreaElement:S,minePossibleElement:D,allowUndoElement:P,singleClickChordElement:H,allowFlagChordElement:A,mineFieldBoard:V,minefieldBoardWrapper:Y,resetButton:X,resetHeader:J,minesRemainingElements:z,timerElements:Z,debugElement:j}}var I=typeof window>"u"?void 0:window;I&&I.addEventListener("load",()=>{G(I)});
